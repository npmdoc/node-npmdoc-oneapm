<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://oneapm.com/features/nodejs.html"

    >oneapm (v2.0.0)</a>
</h1>
<h4>OneAPM agent</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm">module oneapm</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator">
            function <span class="apidocSignatureSpan">oneapm.</span>aggregator
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex">
            function <span class="apidocSignatureSpan">oneapm.</span>apdex
            <span class="apidocSignatureSpan">(apdexT)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug">
            function <span class="apidocSignatureSpan">oneapm.</span>debug
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.events">
            function <span class="apidocSignatureSpan">oneapm.</span>events
            <span class="apidocSignatureSpan">(mapper)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics">
            function <span class="apidocSignatureSpan">oneapm.</span>metrics
            <span class="apidocSignatureSpan">(apdexT, mapper, normalizer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.nosql_statement">
            function <span class="apidocSignatureSpan">oneapm.</span>nosql_statement
            <span class="apidocSignatureSpan">(type, operation, model)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.parsed_statement">
            function <span class="apidocSignatureSpan">oneapm.</span>parsed_statement
            <span class="apidocSignatureSpan">(type, operation, model, raw)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.reservoir">
            function <span class="apidocSignatureSpan">oneapm.</span>reservoir
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment">
            function <span class="apidocSignatureSpan">oneapm.</span>segment
            <span class="apidocSignatureSpan">(trace, name, recorder)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sql">
            function <span class="apidocSignatureSpan">oneapm.</span>sql
            <span class="apidocSignatureSpan">(query, transaction, stats)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.statement_matcher">
            function <span class="apidocSignatureSpan">oneapm.</span>statement_matcher
            <span class="apidocSignatureSpan">(operation, operationPattern)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats">
            function <span class="apidocSignatureSpan">oneapm.</span>stats
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stream_sink">
            function <span class="apidocSignatureSpan">oneapm.</span>stream_sink
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer">
            function <span class="apidocSignatureSpan">oneapm.</span>timer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace">
            function <span class="apidocSignatureSpan">oneapm.</span>trace
            <span class="apidocSignatureSpan">(transaction)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer">
            function <span class="apidocSignatureSpan">oneapm.</span>tracer
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction">
            function <span class="apidocSignatureSpan">oneapm.</span>transaction
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>aggregator.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>apdex.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>codec</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>debug.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>events.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>last_io</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>metrics.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>nosql_statement.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>parsed_statement.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>reservoir.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>sampler</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>segment.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>sql.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>stack</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>statement_matcher.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>stats.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>stream_sink.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>timer.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>trace.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>tracer.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>transaction.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">oneapm.</span>urltils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.aggregator">module oneapm.aggregator</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator.aggregator">
            function <span class="apidocSignatureSpan">oneapm.</span>aggregator
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.aggregator.prototype">module oneapm.aggregator.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator.prototype.add">
            function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>add
            <span class="apidocSignatureSpan">(transaction)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator.prototype.harvest">
            function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>harvest
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator.prototype.isBetter">
            function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>isBetter
            <span class="apidocSignatureSpan">(name, duration, apdexT)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator.prototype.reset">
            function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>reset
            <span class="apidocSignatureSpan">(trace)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.aggregator.prototype.resetTimingTracker">
            function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>resetTimingTracker
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.apdex">module oneapm.apdex</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex.apdex">
            function <span class="apidocSignatureSpan">oneapm.</span>apdex
            <span class="apidocSignatureSpan">(apdexT)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.apdex.prototype">module oneapm.apdex.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex.prototype.incrementFrustrating">
            function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>incrementFrustrating
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex.prototype.merge">
            function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>merge
            <span class="apidocSignatureSpan">(other)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex.prototype.recordValue">
            function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>recordValue
            <span class="apidocSignatureSpan">(time)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex.prototype.recordValueInMillis">
            function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>recordValueInMillis
            <span class="apidocSignatureSpan">(timeInMillis)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.apdex.prototype.toJSON">
            function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.codec">module oneapm.codec</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.codec.decode">
            function <span class="apidocSignatureSpan">oneapm.codec.</span>decode
            <span class="apidocSignatureSpan">(encoded, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.codec.encode">
            function <span class="apidocSignatureSpan">oneapm.codec.</span>encode
            <span class="apidocSignatureSpan">(data, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.debug">module oneapm.debug</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.debug">
            function <span class="apidocSignatureSpan">oneapm.</span>debug
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.debug.prototype">module oneapm.debug.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.addSegment">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>addSegment
            <span class="apidocSignatureSpan">(name, recorder)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.bindEmitter">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>bindEmitter
            <span class="apidocSignatureSpan">(emitter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.callbackProxy">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>callbackProxy
            <span class="apidocSignatureSpan">(handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.enter">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>enter
            <span class="apidocSignatureSpan">(call, describer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.exit">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>exit
            <span class="apidocSignatureSpan">(call, describer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.getSegment">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>getSegment
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.getTransaction">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>getTransaction
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.isCurrentSegmentType">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>isCurrentSegmentType
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.segmentProxy">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>segmentProxy
            <span class="apidocSignatureSpan">(handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.setCurrentSegmentType">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>setCurrentSegmentType
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.setSegment">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>setSegment
            <span class="apidocSignatureSpan">(segment)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.setTransaction">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>setTransaction
            <span class="apidocSignatureSpan">(transaction)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.slice">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>slice
            <span class="apidocSignatureSpan">(args)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.traceCall">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>traceCall
            <span class="apidocSignatureSpan">(segment, value, describer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.traceSegment">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>traceSegment
            <span class="apidocSignatureSpan">(transaction, value, describer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.traceTransaction">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>traceTransaction
            <span class="apidocSignatureSpan">(value, describer)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.debug.prototype.transactionProxy">
            function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>transactionProxy
            <span class="apidocSignatureSpan">(handler)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.events">module oneapm.events</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.events.events">
            function <span class="apidocSignatureSpan">oneapm.</span>events
            <span class="apidocSignatureSpan">(mapper)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.events.prototype">module oneapm.events.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.events.prototype.add">
            function <span class="apidocSignatureSpan">oneapm.events.prototype.</span>add
            <span class="apidocSignatureSpan">(newEvent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.events.prototype.overflow">
            function <span class="apidocSignatureSpan">oneapm.events.prototype.</span>overflow
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.events.prototype.toArray">
            function <span class="apidocSignatureSpan">oneapm.events.prototype.</span>toArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.last_io">module oneapm.last_io</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.last_io.bytesRead">
            function <span class="apidocSignatureSpan">oneapm.last_io.</span>bytesRead
            <span class="apidocSignatureSpan">(socket)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.last_io.bytesWritten">
            function <span class="apidocSignatureSpan">oneapm.last_io.</span>bytesWritten
            <span class="apidocSignatureSpan">(socket)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.last_io.markOrUpdate">
            function <span class="apidocSignatureSpan">oneapm.last_io.</span>markOrUpdate
            <span class="apidocSignatureSpan">(socket)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.metrics">module oneapm.metrics</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.metrics">
            function <span class="apidocSignatureSpan">oneapm.</span>metrics
            <span class="apidocSignatureSpan">(apdexT, mapper, normalizer)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.metrics.prototype">module oneapm.metrics.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype._getScopedData">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_getScopedData
            <span class="apidocSignatureSpan">(name, scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype._getUnscopedData">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_getUnscopedData
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype._resolve">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_resolve
            <span class="apidocSignatureSpan">(scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype._toScopedData">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_toScopedData
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype._toUnscopedData">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_toUnscopedData
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.getMetric">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>getMetric
            <span class="apidocSignatureSpan">(name, scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.getOrCreateApdexMetric">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>getOrCreateApdexMetric
            <span class="apidocSignatureSpan">(name, scope, overrideApdex)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.getOrCreateMetric">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>getOrCreateMetric
            <span class="apidocSignatureSpan">(name, scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.measureBytes">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>measureBytes
            <span class="apidocSignatureSpan">(name, size)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.measureMilliseconds">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>measureMilliseconds
            <span class="apidocSignatureSpan">(name, scope, duration, exclusive)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.merge">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>merge
            <span class="apidocSignatureSpan">(other)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.metrics.prototype.toJSON">
            function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.nosql_statement">module oneapm.nosql_statement</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.nosql_statement.nosql_statement">
            function <span class="apidocSignatureSpan">oneapm.</span>nosql_statement
            <span class="apidocSignatureSpan">(type, operation, model)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.nosql_statement.prototype">module oneapm.nosql_statement.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.nosql_statement.prototype.recordMetrics">
            function <span class="apidocSignatureSpan">oneapm.nosql_statement.prototype.</span>recordMetrics
            <span class="apidocSignatureSpan">(segment, scope)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.parsed_statement">module oneapm.parsed_statement</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.parsed_statement.parsed_statement">
            function <span class="apidocSignatureSpan">oneapm.</span>parsed_statement
            <span class="apidocSignatureSpan">(type, operation, model, raw)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.parsed_statement.prototype">module oneapm.parsed_statement.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.parsed_statement.prototype.recordMetrics">
            function <span class="apidocSignatureSpan">oneapm.parsed_statement.prototype.</span>recordMetrics
            <span class="apidocSignatureSpan">(segment, scope)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.reservoir">module oneapm.reservoir</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.reservoir.reservoir">
            function <span class="apidocSignatureSpan">oneapm.</span>reservoir
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.reservoir.prototype">module oneapm.reservoir.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.reservoir.prototype.add">
            function <span class="apidocSignatureSpan">oneapm.reservoir.prototype.</span>add
            <span class="apidocSignatureSpan">(item)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.reservoir.prototype.overflow">
            function <span class="apidocSignatureSpan">oneapm.reservoir.prototype.</span>overflow
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.reservoir.prototype.toArray">
            function <span class="apidocSignatureSpan">oneapm.reservoir.prototype.</span>toArray
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.sampler">module oneapm.sampler</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sampler.checkEvents">
            function <span class="apidocSignatureSpan">oneapm.sampler.</span>checkEvents
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sampler.sampleCPU">
            function <span class="apidocSignatureSpan">oneapm.sampler.</span>sampleCPU
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sampler.sampleMemory">
            function <span class="apidocSignatureSpan">oneapm.sampler.</span>sampleMemory
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sampler.start">
            function <span class="apidocSignatureSpan">oneapm.sampler.</span>start
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sampler.stop">
            function <span class="apidocSignatureSpan">oneapm.sampler.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">oneapm.sampler.</span>state</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.segment">module oneapm.segment</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.segment">
            function <span class="apidocSignatureSpan">oneapm.</span>segment
            <span class="apidocSignatureSpan">(trace, name, recorder)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.segment.prototype">module oneapm.segment.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype._getChildPairs">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>_getChildPairs
            <span class="apidocSignatureSpan">(end)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype._setExclusiveDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>_setExclusiveDurationInMillis
            <span class="apidocSignatureSpan">(duration)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.add">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>add
            <span class="apidocSignatureSpan">(childName, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.end">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.getDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>getDurationInMillis
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.getExclusiveDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>getExclusiveDurationInMillis
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.markAsWeb">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>markAsWeb
            <span class="apidocSignatureSpan">(rawURL)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.setDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>setDurationInMillis
            <span class="apidocSignatureSpan">(duration, start)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.toJSON">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.segment.prototype.touch">
            function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>touch
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.sql">module oneapm.sql</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sql.sql">
            function <span class="apidocSignatureSpan">oneapm.</span>sql
            <span class="apidocSignatureSpan">(query, transaction, stats)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.sql.prototype">module oneapm.sql.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sql.prototype.generateJSON">
            function <span class="apidocSignatureSpan">oneapm.sql.prototype.</span>generateJSON
            <span class="apidocSignatureSpan">(name, params, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.sql.prototype.getSQLId">
            function <span class="apidocSignatureSpan">oneapm.sql.prototype.</span>getSQLId
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.stack">module oneapm.stack</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stack.formatStack">
            function <span class="apidocSignatureSpan">oneapm.stack.</span>formatStack
            <span class="apidocSignatureSpan">(stack)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.statement_matcher">module oneapm.statement_matcher</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.statement_matcher.statement_matcher">
            function <span class="apidocSignatureSpan">oneapm.</span>statement_matcher
            <span class="apidocSignatureSpan">(operation, operationPattern)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.statement_matcher.prototype">module oneapm.statement_matcher.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.statement_matcher.prototype.getParsedStatement">
            function <span class="apidocSignatureSpan">oneapm.statement_matcher.prototype.</span>getParsedStatement
            <span class="apidocSignatureSpan">(type, sql)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.stats">module oneapm.stats</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.stats">
            function <span class="apidocSignatureSpan">oneapm.</span>stats
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.stats.prototype">module oneapm.stats.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.prototype.incrementCallCount">
            function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>incrementCallCount
            <span class="apidocSignatureSpan">(count)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.prototype.merge">
            function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>merge
            <span class="apidocSignatureSpan">(other)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.prototype.recordValue">
            function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>recordValue
            <span class="apidocSignatureSpan">(totalTime, exclusiveTime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.prototype.recordValueInBytes">
            function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>recordValueInBytes
            <span class="apidocSignatureSpan">(bytes, exclusiveBytes)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.prototype.recordValueInMillis">
            function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>recordValueInMillis
            <span class="apidocSignatureSpan">(totalTime, exclusiveTime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stats.prototype.toJSON">
            function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>toJSON
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.stream_sink">module oneapm.stream_sink</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stream_sink.stream_sink">
            function <span class="apidocSignatureSpan">oneapm.</span>stream_sink
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stream_sink.super_">
            function <span class="apidocSignatureSpan">oneapm.stream_sink.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.stream_sink.prototype">module oneapm.stream_sink.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stream_sink.prototype.destroy">
            function <span class="apidocSignatureSpan">oneapm.stream_sink.prototype.</span>destroy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stream_sink.prototype.end">
            function <span class="apidocSignatureSpan">oneapm.stream_sink.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.stream_sink.prototype.write">
            function <span class="apidocSignatureSpan">oneapm.stream_sink.prototype.</span>write
            <span class="apidocSignatureSpan">(string)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.timer">module oneapm.timer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.timer">
            function <span class="apidocSignatureSpan">oneapm.</span>timer
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.timer.prototype">module oneapm.timer.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.begin">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>begin
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.end">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.getDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>getDurationInMillis
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.isActive">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>isActive
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.isRunning">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>isRunning
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.setDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>setDurationInMillis
            <span class="apidocSignatureSpan">(duration, start)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.startedRelativeTo">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>startedRelativeTo
            <span class="apidocSignatureSpan">(other)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.toRange">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>toRange
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.timer.prototype.touch">
            function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>touch
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.trace">module oneapm.trace</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.trace">
            function <span class="apidocSignatureSpan">oneapm.</span>trace
            <span class="apidocSignatureSpan">(transaction)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.trace.prototype">module oneapm.trace.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.add">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>add
            <span class="apidocSignatureSpan">(childName, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.addRecorder">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>addRecorder
            <span class="apidocSignatureSpan">(recorder)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.end">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.generateJSON">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>generateJSON
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.getDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>getDurationInMillis
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.getExclusiveDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>getExclusiveDurationInMillis
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.record">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>record
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.trace.prototype.setDurationInMillis">
            function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>setDurationInMillis
            <span class="apidocSignatureSpan">(duration, startTimeInMillis)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.tracer">module oneapm.tracer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.tracer">
            function <span class="apidocSignatureSpan">oneapm.</span>tracer
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.tracer.prototype">module oneapm.tracer.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.addSegment">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>addSegment
            <span class="apidocSignatureSpan">(name, recorder)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.bindEmitter">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>bindEmitter
            <span class="apidocSignatureSpan">(emitter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.callbackProxy">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>callbackProxy
            <span class="apidocSignatureSpan">(handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.getSegment">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>getSegment
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.getTransaction">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>getTransaction
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.isCurrentSegmentType">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>isCurrentSegmentType
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.segmentProxy">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>segmentProxy
            <span class="apidocSignatureSpan">(handler)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.setCurrentSegmentType">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>setCurrentSegmentType
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.setSegment">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>setSegment
            <span class="apidocSignatureSpan">(segment)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.setTransaction">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>setTransaction
            <span class="apidocSignatureSpan">(transaction)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.slice">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>slice
            <span class="apidocSignatureSpan">(args)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.tracer.prototype.transactionProxy">
            function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>transactionProxy
            <span class="apidocSignatureSpan">(handler)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.transaction">module oneapm.transaction</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.transaction">
            function <span class="apidocSignatureSpan">oneapm.</span>transaction
            <span class="apidocSignatureSpan">(agent)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.transaction.prototype">module oneapm.transaction.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype._setApdex">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>_setApdex
            <span class="apidocSignatureSpan">(name, duration, keyApdexInMillis)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.addRecorder">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>addRecorder
            <span class="apidocSignatureSpan">(recorder)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.applyUserNamingRules">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>applyUserNamingRules
            <span class="apidocSignatureSpan">(requestUrl)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.end">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>end
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.getTrace">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>getTrace
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.isActive">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>isActive
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.isWeb">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>isWeb
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.measure">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>measure
            <span class="apidocSignatureSpan">(name, scope, duration, exclusive)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.record">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>record
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.transaction.prototype.setName">
            function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>setName
            <span class="apidocSignatureSpan">(requestURL, statusCode)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.oneapm.urltils">module oneapm.urltils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.urltils.copyParameters">
            function <span class="apidocSignatureSpan">oneapm.urltils.</span>copyParameters
            <span class="apidocSignatureSpan">(config, source, destination)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.urltils.isError">
            function <span class="apidocSignatureSpan">oneapm.urltils.</span>isError
            <span class="apidocSignatureSpan">(config, code)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.urltils.parseParameters">
            function <span class="apidocSignatureSpan">oneapm.urltils.</span>parseParameters
            <span class="apidocSignatureSpan">(requestURL)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.oneapm.urltils.scrub">
            function <span class="apidocSignatureSpan">oneapm.urltils.</span>scrub
            <span class="apidocSignatureSpan">(requestURL)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm" id="apidoc.module.oneapm">module oneapm</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.aggregator" id="apidoc.element.oneapm.aggregator">
        function <span class="apidocSignatureSpan">oneapm.</span>aggregator
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TraceAggregator(config) {
  if (!config) throw new Error(&#x22;Trace aggregator needs configuration at creation.&#x22;);

<span class="apidocCodeCommentSpan">  /**
   * 5 Transaction Trace Guarantee
   *
   * For the initial experience problem, the Agent will sample up to 1
   * transaction per minute until it has sampled 5 transactions. This
   * guarantees that the agent will always report some transaction traces.
   * There is no time out for this sampling period - the agent always
   * samples until it has collected 5 transactions. The agent doesn&#x27;t
   * simply report the first 5 transactions that it sees because it&#x27;s
   * likely (particularly for a local dev test) that all 5 transactions
   * would be associated with one request (a single web page and its
   * resources).
   */
</span>  this.reported = 0;
  this.config   = config;

  // Setting up top n capacity.
  this.capacity = 1;
  if (config.transaction_tracer &#x26;&#x26;
      config.transaction_tracer.top_n) {
    this.capacity = config.transaction_tracer.top_n;
  }

  // hidden class optimization
  this.trace            = null;
  this.requestTimes     = {};
  this.noTraceSubmitted = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.apdex" id="apidoc.element.oneapm.apdex">
        function <span class="apidocSignatureSpan">oneapm.</span>apdex
        <span class="apidocSignatureSpan">(apdexT)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ApdexStats(apdexT) {
  if (!apdexT &#x26;&#x26; apdexT !== 0) {
    throw new Error(&#x27;Apdex summary must be created with apdexT.&#x27;);
  }
  this.apdexT = apdexT;

  this.satisfying = 0;
  this.tolerating = 0;
  this.frustrating = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug" id="apidoc.element.oneapm.debug">
        function <span class="apidocSignatureSpan">oneapm.</span>debug
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Tracer(agent) {
  if (!agent) throw new Error(&#x22;Must be initialized with an agent.&#x22;);

  this.numTransactions = 0;
  this.agent           = agent;
  this.describer       = new Describer();

  _patchErrorTracerOntoCLS(agent, namespace);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

if (ignored.indexOf(name) !== -1) {
  return logger.warn(&#x22;Not setting ignored parameter name %s.&#x22;, name);
}

if (name in trace.custom) {
  logger.<span class="apidocCodeKeywordSpan">debug</span>(
    &#x22;Changing custom parameter %s from %s to %s.&#x22;,
    name,
    trace.custom[name],
    value
  );
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.events" id="apidoc.element.oneapm.events">
        function <span class="apidocSignatureSpan">oneapm.</span>events
        <span class="apidocSignatureSpan">(mapper)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Events(mapper) {
    assert(mapper !== null &#x26;&#x26; mapper !== undefined)

    this.mapper = mapper;
    this.list = [];
    this.limit = 0; // not implemented
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics" id="apidoc.element.oneapm.metrics">
        function <span class="apidocSignatureSpan">oneapm.</span>metrics
        <span class="apidocSignatureSpan">(apdexT, mapper, normalizer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Metrics(apdexT, mapper, normalizer) {
  if (apdexT === undefined || apdexT === null || apdexT === &#x27;&#x27;) {
    throw new Error(&#x22;metrics must be created with apdexT&#x22;);
  }
  if (!mapper) throw new Error(&#x22;metrics must be created with a mapper&#x22;);
  if (!normalizer) throw new Error(&#x22;metrics must be created with a name normalizer&#x22;);

  this.started    = Date.now();
  this.apdexT     = apdexT;
  this.mapper     = mapper;
  this.normalizer = normalizer;
  this.unscoped   = {}; // {name : stats} where unscoped stats is put
  this.scoped     = {}; // {scope : {name : stats}}
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.nosql_statement" id="apidoc.element.oneapm.nosql_statement">
        function <span class="apidocSignatureSpan">oneapm.</span>nosql_statement
        <span class="apidocSignatureSpan">(type, operation, model)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ParsedStatement(type, operation, model) {
  this.type      = type;
  this.operation = operation;
  this.model     = model;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.parsed_statement" id="apidoc.element.oneapm.parsed_statement">
        function <span class="apidocSignatureSpan">oneapm.</span>parsed_statement
        <span class="apidocSignatureSpan">(type, operation, model, raw)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ParsedStatement(type, operation, model, raw) {
  this.type      = type;
  this.operation = operation;
  this.model     = model;

  this.trace     = null;
  this.raw       = &#x27;&#x27;;

  if( typeof raw === &#x27;string&#x27; ) {
    this.trace = new Error();
    this.raw   = raw;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.reservoir" id="apidoc.element.oneapm.reservoir">
        function <span class="apidocSignatureSpan">oneapm.</span>reservoir
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Reservoir() {
  this.limit = 10;
  this._size = 0;
  this._data = [];

  this.Random = Math.random;
  this.Floor  = Math.floor;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment" id="apidoc.element.oneapm.segment">
        function <span class="apidocSignatureSpan">oneapm.</span>segment
        <span class="apidocSignatureSpan">(trace, name, recorder)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TraceSegment(trace, name, recorder) {
  if (!trace) throw new Error(&#x27;Trace segments must be bound to a transaction trace.&#x27;);
  if (!name) throw new Error(&#x27;Trace segments must be named.&#x27;);

  this.trace = trace;
  this.name = name;

  if (recorder) this.trace.addRecorder(recorder.bind(null, this));

  this.parameters = {nr_exclusive_duration_millis : null};
  this.children = [];

  this.timer = new Timer();
  this.timer.begin();

  // hidden class optimization
  this.partialName = null;
  this._exclusiveDuration = null;
  this.host = null;
  this.port = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.sql" id="apidoc.element.oneapm.sql">
        function <span class="apidocSignatureSpan">oneapm.</span>sql
        <span class="apidocSignatureSpan">(query, transaction, stats)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SQLTrace(query, transaction, stats) {
  if (!query) throw new Error(&#x22;Can&#x27;t create SQL trace without SQL!&#x22;);
  if (!transaction) throw new Error(&#x22;Can&#x27;t create SQL trace without transaction.&#x22;);
  if (!stats) throw new Error(&#x22;Can&#x27;t create SQL trace without statistics.&#x22;);

  this.query       = query;
  this.transaction = transaction;
  this.stats       = stats;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.statement_matcher" id="apidoc.element.oneapm.statement_matcher">
        function <span class="apidocSignatureSpan">oneapm.</span>statement_matcher
        <span class="apidocSignatureSpan">(operation, operationPattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StatementMatcher(operation, operationPattern) {
  this.operation        = operation;
  this.operationPattern = operationPattern;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stats" id="apidoc.element.oneapm.stats">
        function <span class="apidocSignatureSpan">oneapm.</span>stats
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Stats() {
  this.total = 0;
  this.totalExclusive = 0;
  this.min = 0;
  this.max = 0;
  this.sumOfSquares = 0;
  this.callCount = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stream_sink" id="apidoc.element.oneapm.stream_sink">
        function <span class="apidocSignatureSpan">oneapm.</span>stream_sink
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StreamSink(callback) {
  EventEmitter.call(this);

  this.callback = callback;
  this.sink = &#x27;&#x27;;
  this.writable = true;

  var sink = this;
  this.on(&#x27;error&#x27;, function handle_error(error) {
    sink.writable = false;
    callback(error);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer" id="apidoc.element.oneapm.timer">
        function <span class="apidocSignatureSpan">oneapm.</span>timer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Timer() {
  this.state = PENDING;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace" id="apidoc.element.oneapm.trace">
        function <span class="apidocSignatureSpan">oneapm.</span>trace
        <span class="apidocSignatureSpan">(transaction)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Trace(transaction) {
  if (!transaction) throw new Error(&#x27;All traces must be associated with a transaction.&#x27;);

  this.transaction = transaction;
  this.recorders = [];

  this.root = new Segment(this, &#x27;ROOT&#x27;);

  this.custom = {};

  // hidden class optimization
  this.parameters = {};
  this.domain     = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 // the complete header to be written to the browser
 var out = util.format(
   RUM_STUB,
   json,
   injectScript(js_agent_loader,config)
 );

 logger.<span class="apidocCodeKeywordSpan">trace</span>(&#x27;generating RUM header&#x27;, out);

 return out;
};

/**
* This creates a new segment with the passed in name. It then wraps the
* callback and binds it to the current transaction and segment so any further
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer" id="apidoc.element.oneapm.tracer">
        function <span class="apidocSignatureSpan">oneapm.</span>tracer
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Tracer(agent) {
  if (!agent) throw new Error(&#x22;Must be initialized with an agent.&#x22;);

  this.agent = agent;

  _patchErrorTracerOntoCLS(agent, namespace);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction" id="apidoc.element.oneapm.transaction">
        function <span class="apidocSignatureSpan">oneapm.</span>transaction
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transaction(agent) {
  if (!agent) throw new Error(&#x27;every transaction must be bound to the agent&#x27;);

  this.agent = agent;
  this.metrics = new Metrics(
    agent.config.apdex_t,
    agent.mapper,
    agent.metricNameNormalizer
  );

  this.id = id++;
  this.exceptions = [];
  this.timer = new Timer();
  this.timer.begin();

  this._recorders  = [];

  // hidden class optimization
  this.url         = null;
  this.fullUrl     = null;
  this.name        = null;
  this.partialName = null;
  this.statusCode  = null;
  this.error       = null;
  this.verb        = null;
  this.trace       = null;
  this.forceIgnore = null;
  this.ignore      = false;
  this.queueTime   = 0;

  // analytic event context
  this.guid = generateGuid();
  this.force_trace = false;
  this.referer_guid = null;
  this.trip_guid = this.guid;
  this.bytesRead = 0;
  this.bytesWritten = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>














































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.aggregator" id="apidoc.module.oneapm.aggregator">module oneapm.aggregator</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.aggregator.aggregator" id="apidoc.element.oneapm.aggregator.aggregator">
        function <span class="apidocSignatureSpan">oneapm.</span>aggregator
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TraceAggregator(config) {
  if (!config) throw new Error(&#x22;Trace aggregator needs configuration at creation.&#x22;);

<span class="apidocCodeCommentSpan">  /**
   * 5 Transaction Trace Guarantee
   *
   * For the initial experience problem, the Agent will sample up to 1
   * transaction per minute until it has sampled 5 transactions. This
   * guarantees that the agent will always report some transaction traces.
   * There is no time out for this sampling period - the agent always
   * samples until it has collected 5 transactions. The agent doesn&#x27;t
   * simply report the first 5 transactions that it sees because it&#x27;s
   * likely (particularly for a local dev test) that all 5 transactions
   * would be associated with one request (a single web page and its
   * resources).
   */
</span>  this.reported = 0;
  this.config   = config;

  // Setting up top n capacity.
  this.capacity = 1;
  if (config.transaction_tracer &#x26;&#x26;
      config.transaction_tracer.top_n) {
    this.capacity = config.transaction_tracer.top_n;
  }

  // hidden class optimization
  this.trace            = null;
  this.requestTimes     = {};
  this.noTraceSubmitted = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.aggregator.prototype" id="apidoc.module.oneapm.aggregator.prototype">module oneapm.aggregator.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.aggregator.prototype.add" id="apidoc.element.oneapm.aggregator.prototype.add">
        function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>add
        <span class="apidocSignatureSpan">(transaction)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(transaction) {
  if (this.config.collect_traces &#x26;&#x26;
      this.config.transaction_tracer &#x26;&#x26; this.config.transaction_tracer.enabled &#x26;&#x26;
      transaction &#x26;&#x26; transaction.metrics) {
    var trace    = transaction.getTrace()
      , name     = transaction.name
      , duration = trace.getDurationInMillis()
      , apdexT   = transaction.metrics.apdexT
      ;

    if (this.isBetter(name, duration, apdexT)) {
      this.trace = trace;

      // because of the &#x22;first 5&#x22; rule, this may or may not be the slowest
      if (!this.requestTimes[name] || this.requestTimes[name] &#x3c; duration) {
        this.requestTimes[name] = duration;
      }
    }

    this.config.measureInternal(&#x27;Transaction/Count&#x27;, duration);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Error}  error            The error to be traced.
* @param {object} customParameters Any custom parameters to be displayed in
*                                  the OneAPM UI.
*/
API.prototype.noticeError = function noticeError(error, customParameters) {
 if (typeof error === &#x27;string&#x27;) error = new Error(error);
 var transaction = this.agent.tracer.getTransaction();
 this.agent.errors.<span class="apidocCodeKeywordSpan">add</span>(transaction, error, customParameters);
};

/**
* If the URL for a transaction matches the provided pattern, name the
* transaction with the provided name. If there are capture groups in the
* pattern (which is a standard JavaScript regular expression, and can be
* passed as either a RegExp or a string), then the substring matches ($1, $2,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.aggregator.prototype.harvest" id="apidoc.element.oneapm.aggregator.prototype.harvest">
        function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>harvest
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function harvest(callback) {
  // calls out to zlib are asynchronous
  if (this.trace) {
    this.noTraceSubmitted = 0;
    this.trace.generateJSON(callback);
  }
  else {
    this.noTraceSubmitted++;
    if (this.noTraceSubmitted &#x3e;= 5) this.resetTimingTracker();

    process.nextTick(function cb_nextTick() { callback(null, null, null); });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        agent.emit(&#x27;command&#x27;, item);
      });
    }
  });
}, COMMAND_FETCH_PERIOD * TO_MILLIS);

// harvest immediately for quicker data display
agent.<span class="apidocCodeKeywordSpan">harvest</span>(function cb_harvest(error) {
  if(process.env.ONEAPM_DEMO){
    console.log(&#x27;DEMO Environment, data_report_period is set to 5&#x27;);
    agent._startHarvester(5);
  }else{
    agent._startHarvester(agent.config.data_report_period);
  }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.aggregator.prototype.isBetter" id="apidoc.element.oneapm.aggregator.prototype.isBetter">
        function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>isBetter
        <span class="apidocSignatureSpan">(name, duration, apdexT)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isBetter(name, duration, apdexT) {

  if(process.env.ONEAPM_FORCE_TRACE_COLLECT){
    return true;
  }

<span class="apidocCodeCommentSpan">  /* 1. If the transaction duration is below the tracing threshold, the
   *    transaction is skipped.
   *
   * The threshold for slow traces defaults to apdex_f, which is 4 * apdex_t.
   */
</span>  var config = this.config.transaction_tracer
    , isOverThreshold
    ;
  if (config &#x26;&#x26;
      config.transaction_threshold &#x26;&#x26;
      config.transaction_threshold !== &#x27;apdex_f&#x27; &#x26;&#x26;
      typeof config.transaction_threshold === &#x27;number&#x27;) {
    isOverThreshold = duration &#x3e; config.transaction_threshold * TO_MILLIS;
  }
  else {
    isOverThreshold = duration &#x3e; 4 * TO_MILLIS * apdexT;
  }
  if (!isOverThreshold) return false;

  /* 2. If the transaction duration is less than the duration of the current
   *    slow transaction, the transaction is skipped.
   */
  var slowerThanExisting = true;
  if (this.trace) {
    slowerThanExisting = this.trace.getDurationInMillis() &#x3c; duration;
  }
  if (!slowerThanExisting) return false;

  /* We always gather some slow transactions at the start, regardless of
   * the size of Top N. This changes the behavior of the rest of the
   * decision-making process in some subtle ways.
   */
  var hasMetGuarantee = this.reported &#x3e;= 5;

  /* 3. If the transaction&#x27;s name is in the transaction map and its duration
   *    is less than the response time in the map, it is skipped.
   */
  var slowerThanCaptured = true;
  if (hasMetGuarantee) {
    if (this.requestTimes[name]) {
      slowerThanCaptured = this.requestTimes[name] &#x3c; duration;
    }
  }
  if (!slowerThanCaptured) return false;

  /* Not part of enumerated rules, but necessary for Top N support:
   * Ensure this name is either already in the request time map
   * or that the map still hasn&#x27;t hit capacity.
   */
  if (hasMetGuarantee &#x26;&#x26;
      !this.requestTimes[name] &#x26;&#x26;
      Object.keys(this.requestTimes).length &#x3e;= this.capacity) {
    return false;
  }

  /* 4. The transaction is held as the slowest transaction.
   */
  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  transaction &#x26;&#x26; transaction.metrics) {
var trace    = transaction.getTrace()
  , name     = transaction.name
  , duration = trace.getDurationInMillis()
  , apdexT   = transaction.metrics.apdexT
  ;

if (this.<span class="apidocCodeKeywordSpan">isBetter</span>(name, duration, apdexT)) {
  this.trace = trace;

  // because of the &#x22;first 5&#x22; rule, this may or may not be the slowest
  if (!this.requestTimes[name] || this.requestTimes[name] &#x3c; duration) {
    this.requestTimes[name] = duration;
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.aggregator.prototype.reset" id="apidoc.element.oneapm.aggregator.prototype.reset">
        function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>reset
        <span class="apidocSignatureSpan">(trace)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reset(trace) {
  this.reported++;
  if (trace === this.trace) this.trace = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }

  this.traces.harvest(function cb_harvest(error, encoded, trace) {
    if (error || !encoded) return callback(error);

    var payload = [agent.config.run_id, [encoded]];
    agent.collector.transactionSampleData(payload, function cb_transactionSampleData(error) {
      if (!error) agent.traces.<span class="apidocCodeKeywordSpan">reset</span>(trace);

      callback(error);
    });
  });
}
else {
  process.nextTick(callback);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.aggregator.prototype.resetTimingTracker" id="apidoc.element.oneapm.aggregator.prototype.resetTimingTracker">
        function <span class="apidocSignatureSpan">oneapm.aggregator.prototype.</span>resetTimingTracker
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function resetTT() {
  this.requestTimes     = {};
  this.noTraceSubmitted = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 // calls out to zlib are asynchronous
 if (this.trace) {
   this.noTraceSubmitted = 0;
   this.trace.generateJSON(callback);
 }
 else {
   this.noTraceSubmitted++;
   if (this.noTraceSubmitted &#x3e;= 5) this.<span class="apidocCodeKeywordSpan">resetTimingTracker</span>();

   process.nextTick(function cb_nextTick() { callback(null, null, null); });
 }
};

/**
* Reset the trace diversity settings after a successful harvest.
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.apdex" id="apidoc.module.oneapm.apdex">module oneapm.apdex</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.apdex.apdex" id="apidoc.element.oneapm.apdex.apdex">
        function <span class="apidocSignatureSpan">oneapm.</span>apdex
        <span class="apidocSignatureSpan">(apdexT)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ApdexStats(apdexT) {
  if (!apdexT &#x26;&#x26; apdexT !== 0) {
    throw new Error(&#x27;Apdex summary must be created with apdexT.&#x27;);
  }
  this.apdexT = apdexT;

  this.satisfying = 0;
  this.tolerating = 0;
  this.frustrating = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.apdex.prototype" id="apidoc.module.oneapm.apdex.prototype">module oneapm.apdex.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.apdex.prototype.incrementFrustrating" id="apidoc.element.oneapm.apdex.prototype.incrementFrustrating">
        function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>incrementFrustrating
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function incrementFrustrating() {
  this.frustrating++;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param {number} duration Duration of the transaction, in milliseconds.
 * @param {number} keyApdex A key transaction apdexT, in milliseconds
 *                          (optional).
 */
Transaction.prototype._setApdex = function _setApdex(name, duration, keyApdexInMillis) {
  var apdexStats = this.metrics.getOrCreateApdexMetric(name, null, keyApdexInMillis);
  if (urltils.isError(this.agent.config, this.statusCode)) {
    apdexStats.<span class="apidocCodeKeywordSpan">incrementFrustrating</span>();
  }
  else {
    apdexStats.recordValueInMillis(duration);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.apdex.prototype.merge" id="apidoc.element.oneapm.apdex.prototype.merge">
        function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>merge
        <span class="apidocSignatureSpan">(other)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function merge(other) {
  this.satisfying  += other.satisfying;
  this.tolerating  += other.tolerating;
  this.frustrating += other.frustrating;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.metrics.getOrCreateMetric(NAMES.ERRORS.WEB).incrementCallCount(this.errors.errorWebCount);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.OTHER).incrementCallCount(this.errors.errorOtherCount);
}


// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.<span class="apidocCodeKeywordSpan">merge</span>(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.toJSON().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.apdex.prototype.recordValue" id="apidoc.element.oneapm.apdex.prototype.recordValue">
        function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>recordValue
        <span class="apidocSignatureSpan">(time)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordValue(time) {
  if (time &#x3c;= this.apdexT) {
    this.satisfying++;
  }
  else if (time &#x3c;= 4 * this.apdexT) {
    this.tolerating++;
  }
  else {
    this.frustrating++;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return function CPUSampler() {
  //result is {cpu:percentage ...}
  pidusage.stat(process.pid, function (err, result) {
    if (err) {

    } else {
      var stats = agent.metrics.getOrCreateMetric(NAMES.CPU.USERUtilization);
      stats.<span class="apidocCodeKeywordSpan">recordValue</span>(result.cpu / 100);
    }
  });
};
}

function sampleMemory(agent) {
return function memorySampler() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.apdex.prototype.recordValueInMillis" id="apidoc.element.oneapm.apdex.prototype.recordValueInMillis">
        function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>recordValueInMillis
        <span class="apidocSignatureSpan">(timeInMillis)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordValueInMillis(timeInMillis) {
  this.recordValue(timeInMillis * FROM_MILLIS);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Number} duration The duration of the related operation, in milliseconds.
* @param {Number} exclusive (Optional) The portion of the operation specific to this
*                           metric.
* @return {Stats} The aggregated data related to this metric.
*/
Metrics.prototype.measureMilliseconds = function measureMilliseconds(name, scope, duration, exclusive) {
 var stats = this.getOrCreateMetric(name, scope);
 stats.<span class="apidocCodeKeywordSpan">recordValueInMillis</span>(duration, exclusive);
 return stats;
};

/**
* Set the size of an operation. If there are no data for the name existing,
* the collection will create a set of data before recording the measurement.
*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.apdex.prototype.toJSON" id="apidoc.element.oneapm.apdex.prototype.toJSON">
        function <span class="apidocSignatureSpan">oneapm.apdex.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toJSON() {
  return [
    this.satisfying,
    this.tolerating,
    this.frustrating,
    this.apdexT,
    this.apdexT,
    0
  ];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.merge(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.<span class="apidocCodeKeywordSpan">toJSON</span>().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}

var metrics      = this.metrics
  , beginSeconds = metrics.started * FROM_MILLIS
  , endSeconds   = Date.now() * FROM_MILLIS
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.codec" id="apidoc.module.oneapm.codec">module oneapm.codec</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.codec.decode" id="apidoc.element.oneapm.codec.decode">
        function <span class="apidocSignatureSpan">oneapm.codec.</span>decode
        <span class="apidocSignatureSpan">(encoded, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function decode(encoded, callback) {
  zlib.inflate(new Buffer(encoded, &#x27;base64&#x27;), function cb_inflate(err, raw) {
    if (err) return callback(err);

    try {
      return callback(null, JSON.parse(raw));
    }
    catch (error) {
      return callback(error);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.codec.encode" id="apidoc.element.oneapm.codec.encode">
        function <span class="apidocSignatureSpan">oneapm.codec.</span>encode
        <span class="apidocSignatureSpan">(data, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function encode(data, callback) {
  zlib.deflate(JSON.stringify(data), function cb_deflate(err, raw) {
    if (err) return callback(err);

    return callback(null, raw.toString(&#x27;base64&#x27;));
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  userAttributes  : this.custom,
  intrinsics      : {}
},
[]  // FIXME: parameter groups
  ];

  var trace = this;
  codec.<span class="apidocCodeKeywordSpan">encode</span>(rootNode, function cb_encode(err, encoded) {
if (err) return callback(err, null, null);

var json = [
  trace.root.timer.start,
  trace.getDurationInMillis(),
  trace.transaction.name,
  trace.transaction.url,
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.debug" id="apidoc.module.oneapm.debug">module oneapm.debug</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.debug.debug" id="apidoc.element.oneapm.debug.debug">
        function <span class="apidocSignatureSpan">oneapm.</span>debug
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Tracer(agent) {
  if (!agent) throw new Error(&#x22;Must be initialized with an agent.&#x22;);

  this.numTransactions = 0;
  this.agent           = agent;
  this.describer       = new Describer();

  _patchErrorTracerOntoCLS(agent, namespace);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

if (ignored.indexOf(name) !== -1) {
  return logger.warn(&#x22;Not setting ignored parameter name %s.&#x22;, name);
}

if (name in trace.custom) {
  logger.<span class="apidocCodeKeywordSpan">debug</span>(
    &#x22;Changing custom parameter %s from %s to %s.&#x22;,
    name,
    trace.custom[name],
    value
  );
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.debug.prototype" id="apidoc.module.oneapm.debug.prototype">module oneapm.debug.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.addSegment" id="apidoc.element.oneapm.debug.prototype.addSegment">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>addSegment
        <span class="apidocSignatureSpan">(name, recorder)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addSegment(name, recorder) {
  var current              = this.getSegment()
    , segment              = current.add(name, recorder)
    , transactionContainer = namespace.get(&#x27;transaction&#x27;)
    , transaction          = transactionContainer.value
    , describer            = transaction.describer
    , segmentContainer     = this.traceSegment(transactionContainer, segment, describer)
    ;

  this.setSegment(segmentContainer);

  return segment;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
API.prototype.createSegment = function createSegment(name, callback) {
  // FLAG: custom_instrumentation
  if (!this.agent.config.feature_flag.custom_instrumentation) {
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.<span class="apidocCodeKeywordSpan">addSegment</span>(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.end();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.bindEmitter" id="apidoc.element.oneapm.debug.prototype.bindEmitter">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>bindEmitter
        <span class="apidocSignatureSpan">(emitter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function bindEmitter(emitter) {
  namespace.bindEmitter(emitter);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* appropriately. CLS will take care of the necessary monkeypatching (which is
* kinda gross and slow, but unavoidable without a more general way of bridging
* synchronous emitters and asynchronous CLS).
*
* @param {EventEmitter} emitter The emitter to be put onto the CLS context.
*/
Tracer.prototype.bindEmitter = function bindEmitter(emitter) {
 namespace.<span class="apidocCodeKeywordSpan">bindEmitter</span>(emitter);
};

/**
* Some instrumented modules make self calls from instrumented functions to
* instrumented functions.  Because developers can&#x27;t do anything about these
* subsidiary calls, and in most cases won&#x27;t even know they&#x27;re there, it
* doesn&#x27;t make sense to put them on the transaction trace. The instrumentation
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.callbackProxy" id="apidoc.element.oneapm.debug.prototype.callbackProxy">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>callbackProxy
        <span class="apidocSignatureSpan">(handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function callbackProxy(handler) {
  // if there&#x27;s no handler, there&#x27;s nothing to proxy.
  if (!handler) return;

  // don&#x27;t implicitly create transactions
  var transaction = this.getTransaction();
  if (!transaction) return handler;

  var describer = transaction.describer;
  describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;C outer&#x27;);

  var segmentContainer = namespace.get(&#x27;segment&#x27;)
    , callContainer    = this.traceCall(segmentContainer, handler, describer)
    ;

  var context = namespace.createContext();
  context.segment = segmentContainer;
  context.call = callContainer;

  var self = this;
  var wrapped = namespace.bind(function cb_bind() {
    describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;C inner&#x27;);

    self.enter(callContainer, describer);
    var returned = handler.apply(this, arguments);
    self.exit(callContainer, describer);

    describer.traceWrapping(&#x27;&#x3c;-&#x27;, &#x27;C inner&#x27;);
    return returned;
  }, context);

  describer.traceWrapping(&#x27;&#x3c;-&#x27;, &#x27;C outer&#x27;);
  return wrapped;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // FLAG: custom_instrumentation
  if (!this.agent.config.feature_flag.custom_instrumentation) {
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.<span class="apidocCodeKeywordSpan">callbackProxy</span>(function () {
    callback.apply(this, arguments);
    segment.end();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.enter" id="apidoc.element.oneapm.debug.prototype.enter">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>enter
        <span class="apidocSignatureSpan">(call, describer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function enter(call, describer) {
  describer.traceCall(&#x27;-&#x3e;&#x27;, call);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/* NOICE HAX D00D
 *
 * Will leave the end state of the transaction, including the various
 * traces, attached to the transaction.
 */
transaction.describer = describer;

self.<span class="apidocCodeKeywordSpan">enter</span>(callContainer, describer);
var returned;
namespace.bind(function cb_bind() {
  self.setTransaction(transactionContainer);
  self.setSegment(segmentContainer);
  returned = namespace.bind(handler).apply(proxied, args);
}, Object.create(null))();
self.exit(callContainer, describer);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.exit" id="apidoc.element.oneapm.debug.prototype.exit">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>exit
        <span class="apidocSignatureSpan">(call, describer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function exit(call, describer) {
  describer.traceCall(&#x27;&#x3c;-&#x27;, call);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
     var context     = namespace.fromException(error)
       , transaction = (domain &#x26;&#x26; domain.transaction) ||
                       (context &#x26;&#x26; context.transaction)
       ;

     agent.errors.add(transaction, error);

     if (domain) namespace.<span class="apidocCodeKeywordSpan">exit</span>(domain);
   };
 }
}

/**
* EXECUTION TRACER
*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.getSegment" id="apidoc.element.oneapm.debug.prototype.getSegment">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>getSegment
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSegment() {
  return namespace.get(&#x27;segment&#x27;) &#x26;&#x26; namespace.get(&#x27;segment&#x27;).value;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function wrapMatchRequest(version, matchRequest) {
  return function cls_wrapMatchRequest() {
    if (!tracer.getTransaction()) {
      logger.trace(&#x22;Express %d router called outside transaction.&#x22;, version);
      return matchRequest.apply(this, arguments);
    }
    var route = matchRequest.apply(this, arguments);
    nameFromRoute(tracer.<span class="apidocCodeKeywordSpan">getSegment</span>(), route);
    return route;
  };
}

function wrapProcessParams(version, process_params) {
  return function cls_wrapProcessParams() {
    var transaction=tracer.getTransaction();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.getTransaction" id="apidoc.element.oneapm.debug.prototype.getTransaction">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>getTransaction
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getTransaction() {
  var transaction = namespace.get(&#x27;transaction&#x27;);
  if (transaction &#x26;&#x26; transaction.value &#x26;&#x26; transaction.value.isActive()) {
    return transaction.value;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * from within HTTP or HTTPS listener functions, Express routes, or other
 * contexts where a web request or response object are in scope.
 *
 * @param {string} name The name you want to give the web request in the OneAPM
 *                      UI. Will be prefixed with &#x27;Custom/&#x27; when sent.
 */
API.prototype.setTransactionName = function setTransactionName(name) {
var transaction = this.agent.tracer.<span class="apidocCodeKeywordSpan">getTransaction</span>();
if (!transaction) {
  return logger.warn(&#x22;No transaction found when setting name to &#x27;%s&#x27;.&#x22;, name);
}

if (!name) {
  if (transaction.url) {
    logger.error(&#x22;Must include name in setTransactionName call for URL %s.&#x22;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.isCurrentSegmentType" id="apidoc.element.oneapm.debug.prototype.isCurrentSegmentType">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>isCurrentSegmentType
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isCurrentSegmentType(type) {
  return namespace.get(TYPE) === type;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
          logger.trace(&#x22;Tracing MongoDB %s.%s(%j).&#x22;, collection, operation, terms);

          /* Don&#x27;t add segments when MongoDB is calling back into itself.
           * Mildly heuristic: MongoDB operations that self-call do so on the
           * same tick, so if a MongoDB operation has already happened this
           * tick (according to the tracer), then it&#x27;s a self-call.
           */
          if (!tracer.<span class="apidocCodeKeywordSpan">isCurrentSegmentType</span>(MONGODB.PREFIX)) {
tracer.setCurrentSegmentType(MONGODB.PREFIX);
var transaction = tracer.getTransaction(),
  segment = addMongoStatement(tracer, collection, operation);

if (typeof terms === &#x27;object&#x27;) {
  urltils.copyParameters(agent.config, terms, segment.parameters);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.segmentProxy" id="apidoc.element.oneapm.debug.prototype.segmentProxy">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>segmentProxy
        <span class="apidocSignatureSpan">(handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function segmentProxy(handler) {
  // if there&#x27;s no handler, there&#x27;s nothing to proxy.
  if (!handler) return;

  this.describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;S outer&#x27;);

  var self = this;
  var wrapped = function wrapSegmentInvocation() {
    // don&#x27;t implicitly create transactions
    var transactionContainer = namespace.get(&#x27;transaction&#x27;);
    if (!transactionContainer) return handler.apply(this, arguments);

    var transaction = transactionContainer.value;
    if (!transaction.isActive()) return handler.apply(this, arguments);

    var describer = transaction.describer;
    describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;S inner&#x27;);

    var segment          = self.getSegment()
      , segmentContainer = self.traceSegment(transactionContainer, segment, describer)
      , callContainer    = self.traceCall(segmentContainer, handler, describer)
      , context          = namespace.createContext()
      ;

    context.segment = segmentContainer;
    context.call = callContainer;

    self.enter(callContainer, describer);
    var returned = namespace.bind(handler, context).apply(this, arguments);
    self.exit(callContainer, describer);

    describer.traceWrapping(&#x27;&#x3c;-&#x27;, &#x27;S inner&#x27;);
    return returned;
  };

  this.describer.traceWrapping(&#x27;&#x3c;-&#x27;, &#x27;S outer&#x27;);
  return wrapped;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
module.exports = function initialize(agent, memcached) {
  var tracer = agent.tracer;

  shimmer.wrapMethod(memcached &#x26;&#x26; memcached.prototype,
               &#x27;memcached.prototype&#x27;,
               &#x27;command&#x27;,
               function cb_wrapMethod(command) {
    return tracer.<span class="apidocCodeKeywordSpan">segmentProxy</span>(function cb_segmentProxy() {
if (!tracer.getTransaction()) return command.apply(this, arguments);

/* The &#x27;command&#x27; function will be called with a single function argument.
 * That function returns a simple object describing the memcached call.
 * Call that function to get that call description.
 */
var metacall = arguments[0]()
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.setCurrentSegmentType" id="apidoc.element.oneapm.debug.prototype.setCurrentSegmentType">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>setCurrentSegmentType
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setCurrentSegmentType(type) {
  // only add a cleaner if there isn&#x27;t one set already
  if (!namespace.get(TYPE)) process.nextTick(function cb_nextTick() {
    namespace.set(TYPE, undefined);
  });
  namespace.set(TYPE, type);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

          /* Don&#x27;t add segments when MongoDB is calling back into itself.
           * Mildly heuristic: MongoDB operations that self-call do so on the
           * same tick, so if a MongoDB operation has already happened this
           * tick (according to the tracer), then it&#x27;s a self-call.
           */
          if (!tracer.isCurrentSegmentType(MONGODB.PREFIX)) {
tracer.<span class="apidocCodeKeywordSpan">setCurrentSegmentType</span>(MONGODB.PREFIX);
var transaction = tracer.getTransaction(),
  segment = addMongoStatement(tracer, collection, operation);

if (typeof terms === &#x27;object&#x27;) {
  urltils.copyParameters(agent.config, terms, segment.parameters);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.setSegment" id="apidoc.element.oneapm.debug.prototype.setSegment">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>setSegment
        <span class="apidocSignatureSpan">(segment)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSegment(segment) {
  namespace.set(&#x27;segment&#x27;, segment);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    , proxied     = this
    , args        = self.slice(arguments)
    ;

  var returned;
  namespace.bind(function cb_bind() {
    self.setTransaction(transaction);
    self.<span class="apidocCodeKeywordSpan">setSegment</span>(transaction.getTrace().root);
    returned = namespace.bind(handler).apply(proxied, args);
  }, Object.create(null))();

  return returned;
};
wrapped[ORIGINAL] = handler;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.setTransaction" id="apidoc.element.oneapm.debug.prototype.setTransaction">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>setTransaction
        <span class="apidocSignatureSpan">(transaction)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setTransaction(transaction) {
  namespace.set(&#x27;transaction&#x27;, transaction);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var transaction = self.getTransaction() || new Transaction(self.agent)
    , proxied     = this
    , args        = self.slice(arguments)
    ;

  var returned;
  namespace.bind(function cb_bind() {
    self.<span class="apidocCodeKeywordSpan">setTransaction</span>(transaction);
    self.setSegment(transaction.getTrace().root);
    returned = namespace.bind(handler).apply(proxied, args);
  }, Object.create(null))();

  return returned;
};
wrapped[ORIGINAL] = handler;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.slice" id="apidoc.element.oneapm.debug.prototype.slice">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>slice
        <span class="apidocSignatureSpan">(args)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function slice(args) {
<span class="apidocCodeCommentSpan">  /**
   * Usefully nerfed version of slice for use in instrumentation. Way faster
   * than using [].slice.call, and maybe putting it in here (instead of the
   * same module context where it will be used) will make it faster by
   * defeating inlining.
   *
   *   http://jsperf.com/array-slice-call-arguments-2
   *
   *  for untrustworthy benchmark numbers. Only useful for copying whole
   *  arrays, and really only meant to be used with the arguments arraylike.
   *
   *  Also putting this comment inside the function in an effort to defeat
   *  inlining.
   */
</span>  var length = args.length
    , array = []
    , i
    ;

  for (i = 0; i &#x3c; length; i++) {
    array[i] = args[i];
  }

  return array;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.query = query
this.metric = segment.name
this.trace = stackUtil.formatStack(trace.stack)  // trace is an Error object, for capturing the stack.
this.duration = segment.getDurationInMillis()
}

function normalizedHash(value) {
return parseInt(crypto.createHash(&#x27;md5&#x27;).update(value).digest(&#x27;hex&#x27;).<span class="apidocCodeKeywordSpan">slice
</span>(-4), 16)
}

function getQuery(config, trace) {
switch (config.transaction_tracer.record_sql) {
  case &#x27;raw&#x27;:
    return trace.query
  case &#x27;obfuscated&#x27;:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.traceCall" id="apidoc.element.oneapm.debug.prototype.traceCall">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>traceCall
        <span class="apidocSignatureSpan">(segment, value, describer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function traceCall(segment, value, describer) {
  describer.traceCreation(&#x27;Call&#x27;);
  return segment.addCall(value);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.setSegment(segmentContainer);

  return segment;
};


Tracer.prototype.enter = function enter(call, describer) {
  describer.<span class="apidocCodeKeywordSpan">traceCall</span>(&#x27;-&#x3e;&#x27;, call);
};

Tracer.prototype.exit = function exit(call, describer) {
  describer.traceCall(&#x27;&#x3c;-&#x27;, call);
};

Tracer.prototype.traceTransaction = function traceTransaction(value, describer) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.traceSegment" id="apidoc.element.oneapm.debug.prototype.traceSegment">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>traceSegment
        <span class="apidocSignatureSpan">(transaction, value, describer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function traceSegment(transaction, value, describer) {
  describer.traceCreation(&#x27;Segment&#x27;);
  return transaction.addSegment(value);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Tracer.prototype.addSegment = function addSegment(name, recorder) {
  var current              = this.getSegment()
    , segment              = current.add(name, recorder)
    , transactionContainer = namespace.get(&#x27;transaction&#x27;)
    , transaction          = transactionContainer.value
    , describer            = transaction.describer
    , segmentContainer     = this.<span class="apidocCodeKeywordSpan">traceSegment</span>(transactionContainer, segment, describer
)
    ;

  this.setSegment(segmentContainer);

  return segment;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.traceTransaction" id="apidoc.element.oneapm.debug.prototype.traceTransaction">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>traceTransaction
        <span class="apidocSignatureSpan">(value, describer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function traceTransaction(value, describer) {
  this.numTransactions += 1;

  describer.traceCreation(&#x27;Trace&#x27;);
  return new Transaction(this.numTransactions, value, describer);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;T inner&#x27;);

// don&#x27;t nest transactions, reuse existing ones
var transaction          = self.getTransaction() || new NRTransaction(self.agent)
  , segment              = transaction.getTrace().root
  , proxied              = this
  , args                 = self.slice(arguments)
  , transactionContainer = self.<span class="apidocCodeKeywordSpan">traceTransaction</span>(transaction, describer)
  , segmentContainer     = self.traceSegment(transactionContainer, segment, describer)
  , callContainer        = self.traceCall(segmentContainer, handler, describer)
  ;

/* NOICE HAX D00D
 *
 * Will leave the end state of the transaction, including the various
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.debug.prototype.transactionProxy" id="apidoc.element.oneapm.debug.prototype.transactionProxy">
        function <span class="apidocSignatureSpan">oneapm.debug.prototype.</span>transactionProxy
        <span class="apidocSignatureSpan">(handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function transactionProxy(handler) {
  // if there&#x27;s no handler, there&#x27;s nothing to proxy.
  if (!handler) return;

  this.describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;T outer&#x27;);

  var self = this;
  var wrapped = function wrapTransactionInvocation() {
    var describer = self.describer.clone();
    describer.traceWrapping(&#x27;-&#x3e;&#x27;, &#x27;T inner&#x27;);

    // don&#x27;t nest transactions, reuse existing ones
    var transaction          = self.getTransaction() || new NRTransaction(self.agent)
      , segment              = transaction.getTrace().root
      , proxied              = this
      , args                 = self.slice(arguments)
      , transactionContainer = self.traceTransaction(transaction, describer)
      , segmentContainer     = self.traceSegment(transactionContainer, segment, describer)
      , callContainer        = self.traceCall(segmentContainer, handler, describer)
      ;

<span class="apidocCodeCommentSpan">    /* NOICE HAX D00D
     *
     * Will leave the end state of the transaction, including the various
     * traces, attached to the transaction.
     */
</span>    transaction.describer = describer;

    self.enter(callContainer, describer);
    var returned;
    namespace.bind(function cb_bind() {
      self.setTransaction(transactionContainer);
      self.setSegment(segmentContainer);
      returned = namespace.bind(handler).apply(proxied, args);
    }, Object.create(null))();
    self.exit(callContainer, describer);

    describer.traceWrapping(&#x27;&#x3c;-&#x27;, &#x27;T inner&#x27;);
    return returned;
  };

  this.describer.traceWrapping(&#x27;&#x3c;-&#x27;, &#x27;T outer&#x27;);
  return wrapped;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var tracer = agent.tracer;

  shimmer.wrapMethod( thrift, &#x27;thrift&#x27;, &#x27;createServer&#x27;, function wrapper(createServer) {
    return tracer.callbackProxy(function wrappedHandler(service, provider) {
      for( let k in provider ) {
        shimmer.wrapMethod( provider, &#x27;thrift_service.&#x27; + k, k, function wrapper( original ) {

          var proxied = tracer.<span class="apidocCodeKeywordSpan">transactionProxy</span>( function wrapService() {
var transaction = tracer.getTransaction();
if (!transaction) return original.apply(this, arguments);

// Mark it as a web transaction:
transaction.url = THRIFT.PREFIX + &#x27;/&#x27; + k;
transaction.verb = THRIFT.PREFIX;
transaction.partialName = THRIFT.PREFIX + &#x27;/&#x27; + k;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.events" id="apidoc.module.oneapm.events">module oneapm.events</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.events.events" id="apidoc.element.oneapm.events.events">
        function <span class="apidocSignatureSpan">oneapm.</span>events
        <span class="apidocSignatureSpan">(mapper)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Events(mapper) {
    assert(mapper !== null &#x26;&#x26; mapper !== undefined)

    this.mapper = mapper;
    this.list = [];
    this.limit = 0; // not implemented
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.events.prototype" id="apidoc.module.oneapm.events.prototype">module oneapm.events.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.events.prototype.add" id="apidoc.element.oneapm.events.prototype.add">
        function <span class="apidocSignatureSpan">oneapm.events.prototype.</span>add
        <span class="apidocSignatureSpan">(newEvent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (newEvent) {
    this.list.push(newEvent)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Error}  error            The error to be traced.
* @param {object} customParameters Any custom parameters to be displayed in
*                                  the OneAPM UI.
*/
API.prototype.noticeError = function noticeError(error, customParameters) {
 if (typeof error === &#x27;string&#x27;) error = new Error(error);
 var transaction = this.agent.tracer.getTransaction();
 this.agent.errors.<span class="apidocCodeKeywordSpan">add</span>(transaction, error, customParameters);
};

/**
* If the URL for a transaction matches the provided pattern, name the
* transaction with the provided name. If there are capture groups in the
* pattern (which is a standard JavaScript regular expression, and can be
* passed as either a RegExp or a string), then the substring matches ($1, $2,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.events.prototype.overflow" id="apidoc.element.oneapm.events.prototype.overflow">
        function <span class="apidocSignatureSpan">oneapm.events.prototype.</span>overflow
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function overflow() {
    // never overflow
    return 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var newlimit = agent.config.transaction_events.max_samples_stored;
  agent.events.limit = newlimit;

  for(var k=0; k&#x3c;sample.length; k++) agent.events.add(sample[k]);
}
else {
  // if we had to limit events and sample them, emit a warning
  var diff = events.<span class="apidocCodeKeywordSpan">overflow</span>();
  if (diff &#x3e; 0) logger.warn(
    &#x27;analytics event overflow, dropped %d events; &#x27; +
     &#x27;try increasing your limit above %d&#x27;,
    diff, events.limit
  );
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.events.prototype.toArray" id="apidoc.element.oneapm.events.prototype.toArray">
        function <span class="apidocSignatureSpan">oneapm.events.prototype.</span>toArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toArray = function () {
    var mapper = this.mapper
    // list of: [{name, events}, ...]
    var groupByName = groupEventsByName(this.list)
    var array = groupByName.map(function(group) {
        return [
            mapName(group.name),
            group.events.map(function(event) {
                return [
                    event.startTime,
                    event.guid,
                    event.refererGuid,
                    event.tripGuid,
                    event.callCount,
                    event.duration,
                    event.errors,
                    event.ApdexPerfZone,
                    event.requestUrl,
                    event.bytesWritten,
                    event.bytesRead,
                    event.hasTrace ? 1 : 0,
                    event.execTime,
                    event.isAsync ? 1 : 0,
                ]
            })
        ]
    })
    return array;

    function mapName(groupName) {
        assert(Array.isArray(groupName) &#x26;&#x26; groupName.length === 3)
        var transactionName = groupName[1]
        var metricId = mapper.map(transactionName)
        if (typeof metricId === &#x27;number&#x27;) {
            return [metricId]
        }
        else {
            return groupName
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  })
}

Agent.prototype._sendEvents = function _sendEvents (callback) {
  if (this.config.transaction_events.enabled) {
var agent  = this;
var events = agent.events;
var sample = events.<span class="apidocCodeKeywordSpan">toArray</span>();
var run_id = agent.config.run_id;

// bail if there are no events
if (sample.length &#x3c; 1) {
  return process.nextTick(callback);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.last_io" id="apidoc.module.oneapm.last_io">module oneapm.last_io</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.last_io.bytesRead" id="apidoc.element.oneapm.last_io.bytesRead">
        function <span class="apidocSignatureSpan">oneapm.last_io.</span>bytesRead
        <span class="apidocSignatureSpan">(socket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function bytesRead(socket) {	
	var last = socket.hasOwnProperty(&#x27;__OneAPM_LastIO&#x27;) ? socket.__OneAPM_LastIO.bytesRead : 0
	return socket.bytesRead - last
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

    }

    function instrumentedFinish() {
/* Stats how many bytes sended and received
 */
transaction.bytesRead = lastIO.<span class="apidocCodeKeywordSpan">bytesRead</span>(request.socket)
transaction.bytesWritten = lastIO.bytesWritten(request.socket)
lastIO.markOrUpdate(request.socket)

/* Express breaks URLs up by application, but the unmodified URL can be
 * recovered from the request via request.originalUrl.
 */
var url = request.originalUrl || request.url;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.last_io.bytesWritten" id="apidoc.element.oneapm.last_io.bytesWritten">
        function <span class="apidocSignatureSpan">oneapm.last_io.</span>bytesWritten
        <span class="apidocSignatureSpan">(socket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function bytesWritten(socket) {	
	var last = socket.hasOwnProperty(&#x27;__OneAPM_LastIO&#x27;) ? socket.__OneAPM_LastIO.bytesWritten : 0
	return socket.bytesWritten - last
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    }

    function instrumentedFinish() {
/* Stats how many bytes sended and received
 */
transaction.bytesRead = lastIO.bytesRead(request.socket)
transaction.bytesWritten = lastIO.<span class="apidocCodeKeywordSpan">bytesWritten</span>(request.socket)
lastIO.markOrUpdate(request.socket)

/* Express breaks URLs up by application, but the unmodified URL can be
 * recovered from the request via request.originalUrl.
 */
var url = request.originalUrl || request.url;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.last_io.markOrUpdate" id="apidoc.element.oneapm.last_io.markOrUpdate">
        function <span class="apidocSignatureSpan">oneapm.last_io.</span>markOrUpdate
        <span class="apidocSignatureSpan">(socket)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function markOrUpdate(socket) {	
	if (!socket.hasOwnProperty(&#x27;__OneAPM_LastIO&#x27;)) {
		socket.__OneAPM_LastIO = {
			bytesRead: socket.bytesRead,
			bytesWritten: socket.bytesWritten
		}
	}
	else {
		socket.__OneAPM_LastIO.bytesRead = socket.bytesRead
		socket.__OneAPM_LastIO.bytesWritten = socket.bytesWritten
	}
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }

    function instrumentedFinish() {
/* Stats how many bytes sended and received
 */
transaction.bytesRead = lastIO.bytesRead(request.socket)
transaction.bytesWritten = lastIO.bytesWritten(request.socket)
lastIO.<span class="apidocCodeKeywordSpan">markOrUpdate</span>(request.socket)

/* Express breaks URLs up by application, but the unmodified URL can be
 * recovered from the request via request.originalUrl.
 */
var url = request.originalUrl || request.url;

/* Naming must happen before the segment and transaction are ended,
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.metrics" id="apidoc.module.oneapm.metrics">module oneapm.metrics</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.metrics.metrics" id="apidoc.element.oneapm.metrics.metrics">
        function <span class="apidocSignatureSpan">oneapm.</span>metrics
        <span class="apidocSignatureSpan">(apdexT, mapper, normalizer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Metrics(apdexT, mapper, normalizer) {
  if (apdexT === undefined || apdexT === null || apdexT === &#x27;&#x27;) {
    throw new Error(&#x22;metrics must be created with apdexT&#x22;);
  }
  if (!mapper) throw new Error(&#x22;metrics must be created with a mapper&#x22;);
  if (!normalizer) throw new Error(&#x22;metrics must be created with a name normalizer&#x22;);

  this.started    = Date.now();
  this.apdexT     = apdexT;
  this.mapper     = mapper;
  this.normalizer = normalizer;
  this.unscoped   = {}; // {name : stats} where unscoped stats is put
  this.scoped     = {}; // {scope : {name : stats}}
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.metrics.prototype" id="apidoc.module.oneapm.metrics.prototype">module oneapm.metrics.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype._getScopedData" id="apidoc.element.oneapm.metrics.prototype._getScopedData">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_getScopedData
        <span class="apidocSignatureSpan">(name, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _getScopedData(name, scope) {
  if (!this.scoped[scope][name]) return;

  var normalized = this.normalizer.normalize(name);
  if (!normalized) return;

  return [this.mapper.map(normalized, scope), this.scoped[scope][name]];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *                  use by toJSON.
 */
Metrics.prototype._toScopedData = function _toScopedData() {
  var metricData = [];

  Object.keys(this.scoped).forEach(function cb_forEach(scope) {
    Object.keys(this.scoped[scope]).forEach(function cb_forEach(name) {
      var data = this.<span class="apidocCodeKeywordSpan">_getScopedData</span>(name, scope);
      if (data) metricData.push(data);
    }, this);
  }, this);

  return metricData;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype._getUnscopedData" id="apidoc.element.oneapm.metrics.prototype._getUnscopedData">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_getUnscopedData
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _getUnscopedData(name) {
  if (!this.unscoped[name]) return;

  var normalized = this.normalizer.normalize(name);
  if (!normalized) return;

  return [this.mapper.map(normalized), this.unscoped[name]];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @return {object} A serializable version of the unscoped metrics. Intended
 *                  for use by toJSON.
 */
Metrics.prototype._toUnscopedData = function _toUnscopedData() {
  var metricData = [];

  Object.keys(this.unscoped).forEach(function cb_forEach(name) {
    var data = this.<span class="apidocCodeKeywordSpan">_getUnscopedData</span>(name);
    if (data) metricData.push(data);
  }, this);

  return metricData;
};

/**
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype._resolve" id="apidoc.element.oneapm.metrics.prototype._resolve">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_resolve
        <span class="apidocSignatureSpan">(scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _resolve(scope) {
  var resolved;

  if (scope) {
    if (!this.scoped[scope]) this.scoped[scope] = {};

    resolved = this.scoped[scope];
  }
  else {
    resolved = this.unscoped;
  }

  return resolved;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {string} name The name of the requested metric.
* @param {string} scope (Optional) The scope to which the metric is bound.
* @return {Stats} The aggregated data for that name.
*/
Metrics.prototype.getOrCreateMetric = function getOrCreateMetric(name, scope) {
 if (!name) throw new Error(&#x27;Metrics must be named&#x27;);

 var resolved = this.<span class="apidocCodeKeywordSpan">_resolve</span>(scope);
 if (!resolved[name]) resolved[name] = new Stats();
 return resolved[name];
};

/**
* Look up the mapping from a name (and optionally a scope) to a set of metric
* apdex data for that name, creating the data if they don&#x27;t already exist.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype._toScopedData" id="apidoc.element.oneapm.metrics.prototype._toScopedData">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_toScopedData
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _toScopedData() {
  var metricData = [];

  Object.keys(this.scoped).forEach(function cb_forEach(scope) {
    Object.keys(this.scoped[scope]).forEach(function cb_forEach(name) {
      var data = this._getScopedData(name, scope);
      if (data) metricData.push(data);
    }, this);
  }, this);

  return metricData;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Convert this collection into a representation suitable for serialization
* by JSON.stringify and delivery to the collector. Hope you like nested
* arrays!
*
* @return {Object} Set of nested arrays containing metric information.
*/
Metrics.prototype.toJSON = function toJSON() {
 return this._toUnscopedData().concat(this.<span class="apidocCodeKeywordSpan">_toScopedData</span>());
};

/**
* Combine two sets of metric data. Intended to be used as described above,
* either when folding a transaction&#x27;s metrics into the agent&#x27;s metrics for
* later harvest, or one harvest cycle&#x27;s metrics into the next when a
* delivery attempt to the collector fails. Among the more performance-
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype._toUnscopedData" id="apidoc.element.oneapm.metrics.prototype._toUnscopedData">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>_toUnscopedData
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _toUnscopedData() {
  var metricData = [];

  Object.keys(this.unscoped).forEach(function cb_forEach(name) {
    var data = this._getUnscopedData(name);
    if (data) metricData.push(data);
  }, this);

  return metricData;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Convert this collection into a representation suitable for serialization
* by JSON.stringify and delivery to the collector. Hope you like nested
* arrays!
*
* @return {Object} Set of nested arrays containing metric information.
*/
Metrics.prototype.toJSON = function toJSON() {
 return this.<span class="apidocCodeKeywordSpan">_toUnscopedData</span>().concat(this._toScopedData());
};

/**
* Combine two sets of metric data. Intended to be used as described above,
* either when folding a transaction&#x27;s metrics into the agent&#x27;s metrics for
* later harvest, or one harvest cycle&#x27;s metrics into the next when a
* delivery attempt to the collector fails. Among the more performance-
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.getMetric" id="apidoc.element.oneapm.metrics.prototype.getMetric">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>getMetric
        <span class="apidocSignatureSpan">(name, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMetric(name, scope) {
  if (!name) throw new Error(&#x27;Metrics must be named&#x27;);

  return this._resolve(scope)[name];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.getOrCreateApdexMetric" id="apidoc.element.oneapm.metrics.prototype.getOrCreateApdexMetric">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>getOrCreateApdexMetric
        <span class="apidocSignatureSpan">(name, scope, overrideApdex)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getOrCreateApdexMetric(name, scope, overrideApdex) {
  if (!name) throw new Error(&#x27;Metrics must be named&#x27;);

  var resolved = this._resolve(scope)
    , apdexT   = overrideApdex &#x3e; 0 ? (overrideApdex * FROM_MILLIS) : this.apdexT
    ;

  if (!resolved[name]) resolved[name] = new ApdexStats(apdexT);
  return resolved[name];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * @param {string} name     Metric name.
 * @param {number} duration Duration of the transaction, in milliseconds.
 * @param {number} keyApdex A key transaction apdexT, in milliseconds
 *                          (optional).
 */
Transaction.prototype._setApdex = function _setApdex(name, duration, keyApdexInMillis) {
  var apdexStats = this.metrics.<span class="apidocCodeKeywordSpan">getOrCreateApdexMetric</span>(name, null, keyApdexInMillis);
  if (urltils.isError(this.agent.config, this.statusCode)) {
    apdexStats.incrementFrustrating();
  }
  else {
    apdexStats.recordValueInMillis(duration);
  }
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.getOrCreateMetric" id="apidoc.element.oneapm.metrics.prototype.getOrCreateMetric">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>getOrCreateMetric
        <span class="apidocSignatureSpan">(name, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getOrCreateMetric(name, scope) {
  if (!name) throw new Error(&#x27;Metrics must be named&#x27;);

  var resolved = this._resolve(scope);
  if (!resolved[name]) resolved[name] = new Stats();
  return resolved[name];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param {Function} callback Gets any delivery errors.
 */
Agent.prototype._sendMetrics = function _sendMetrics(callback) {
  var agent = this;

  if (this.collector.isConnected()) {
if (this.errors.errorCount &#x3e; 0) {
  this.metrics.<span class="apidocCodeKeywordSpan">getOrCreateMetric</span>(NAMES.ERRORS.ALL).incrementCallCount(this.errors.errorCount
);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.WEB).incrementCallCount(this.errors.errorWebCount);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.OTHER).incrementCallCount(this.errors.errorOtherCount);
}


// merge internal metrics and send them
if (this.config.debug.supportability) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.measureBytes" id="apidoc.element.oneapm.metrics.prototype.measureBytes">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>measureBytes
        <span class="apidocSignatureSpan">(name, size)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function measureBytes(name, size) {
  var stats = this.getOrCreateMetric(name);
  stats.recordValueInBytes(size);
  return stats;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  });
};
}

function sampleMemory(agent) {
return function memorySampler() {
  var mem = process.memoryUsage();
  agent.metrics.<span class="apidocCodeKeywordSpan">measureBytes</span>(NAMES.MEMORY.PHYSICAL, mem.rss);
};
}

function checkEvents(agent) {
return function eventSampler() {
  var timer = new Timer();
  timer.begin();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.measureMilliseconds" id="apidoc.element.oneapm.metrics.prototype.measureMilliseconds">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>measureMilliseconds
        <span class="apidocSignatureSpan">(name, scope, duration, exclusive)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function measureMilliseconds(name, scope, duration, exclusive) {
  var stats = this.getOrCreateMetric(name, scope);
  stats.recordValueInMillis(duration, exclusive);
  return stats;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Sampler.prototype.stop = function stop() {
clearInterval(this.id);
};

function recordQueueTime(agent, timer) {

timer.end();
agent.metrics.<span class="apidocCodeKeywordSpan">measureMilliseconds</span>(NAMES.EVENTS.WAIT, null, timer.getDurationInMillis());
}

/**
 * @since 1.2.2
 */
function sampleCPU(agent) {
var pidusage = require(&#x27;pidusage-fork&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.merge" id="apidoc.element.oneapm.metrics.prototype.merge">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>merge
        <span class="apidocSignatureSpan">(other)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function merge(other) {
  this.started = Math.min(this.started, other.started);

  Object.keys(other.unscoped).forEach(function cb_forEach(name) {
    if (this.unscoped[name]) {
      this.unscoped[name].merge(other.unscoped[name]);
    }
    else {
      this.unscoped[name] = other.unscoped[name];
    }
  }, this);

  Object.keys(other.scoped).forEach(function cb_forEach(scope) {
    Object.keys(other.scoped[scope]).forEach(function cb_forEach(name) {
      if (other.scoped[scope][name]) {
        var resolved = this._resolve(scope);
        if (resolved[name]) {
          resolved[name].merge(other.scoped[scope][name]);
        }
        else {
          resolved[name] = other.scoped[scope][name];
        }
      }
    }, this);
  }, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.metrics.getOrCreateMetric(NAMES.ERRORS.WEB).incrementCallCount(this.errors.errorWebCount);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.OTHER).incrementCallCount(this.errors.errorOtherCount);
}


// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.<span class="apidocCodeKeywordSpan">merge</span>(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.toJSON().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.metrics.prototype.toJSON" id="apidoc.element.oneapm.metrics.prototype.toJSON">
        function <span class="apidocSignatureSpan">oneapm.metrics.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toJSON() {
  return this._toUnscopedData().concat(this._toScopedData());
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.merge(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.<span class="apidocCodeKeywordSpan">toJSON</span>().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}

var metrics      = this.metrics
  , beginSeconds = metrics.started * FROM_MILLIS
  , endSeconds   = Date.now() * FROM_MILLIS
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.nosql_statement" id="apidoc.module.oneapm.nosql_statement">module oneapm.nosql_statement</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.nosql_statement.nosql_statement" id="apidoc.element.oneapm.nosql_statement.nosql_statement">
        function <span class="apidocSignatureSpan">oneapm.</span>nosql_statement
        <span class="apidocSignatureSpan">(type, operation, model)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ParsedStatement(type, operation, model) {
  this.type      = type;
  this.operation = operation;
  this.model     = model;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.nosql_statement.prototype" id="apidoc.module.oneapm.nosql_statement.prototype">module oneapm.nosql_statement.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.nosql_statement.prototype.recordMetrics" id="apidoc.element.oneapm.nosql_statement.prototype.recordMetrics">
        function <span class="apidocSignatureSpan">oneapm.nosql_statement.prototype.</span>recordMetrics
        <span class="apidocSignatureSpan">(segment, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordMetrics(segment, scope) {
  var duration    = segment.getDurationInMillis()
    , exclusive   = segment.getExclusiveDurationInMillis()
    , transaction = segment.trace.transaction
    , type        = transaction.isWeb() ? DS.WEB : DS.OTHER
    , operation   = DS.OPERATION + &#x27;/&#x27; + this.type + &#x27;/&#x27; + this.operation
    , model       = DS.STATEMENT + &#x27;/&#x27; + this.type +
                      &#x27;/&#x27; + this.model + &#x27;/&#x27; + this.operation
    ;


  if (scope) transaction.measure(model, scope, duration, exclusive);

  transaction.measure(model,     null, duration, exclusive);
  transaction.measure(operation, null, duration, exclusive);
  transaction.measure(type,      null, duration, exclusive);
  transaction.measure(DS.ALL,    null, duration, exclusive);

  if (segment.port &#x3e; 0) {
    var hostname = segment.host || &#x27;localhost&#x27;
      , location = hostname + &#x27;:&#x27; + segment.port
      , instance = DS.INSTANCE + &#x27;/&#x27; + this.type + &#x27;/&#x27; + location
      ;

    transaction.measure(instance, null, duration, exclusive);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.parsed_statement" id="apidoc.module.oneapm.parsed_statement">module oneapm.parsed_statement</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.parsed_statement.parsed_statement" id="apidoc.element.oneapm.parsed_statement.parsed_statement">
        function <span class="apidocSignatureSpan">oneapm.</span>parsed_statement
        <span class="apidocSignatureSpan">(type, operation, model, raw)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ParsedStatement(type, operation, model, raw) {
  this.type      = type;
  this.operation = operation;
  this.model     = model;

  this.trace     = null;
  this.raw       = &#x27;&#x27;;

  if( typeof raw === &#x27;string&#x27; ) {
    this.trace = new Error();
    this.raw   = raw;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.parsed_statement.prototype" id="apidoc.module.oneapm.parsed_statement.prototype">module oneapm.parsed_statement.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.parsed_statement.prototype.recordMetrics" id="apidoc.element.oneapm.parsed_statement.prototype.recordMetrics">
        function <span class="apidocSignatureSpan">oneapm.parsed_statement.prototype.</span>recordMetrics
        <span class="apidocSignatureSpan">(segment, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordMetrics(segment, scope) {
  var duration    = segment.getDurationInMillis()
    , exclusive   = segment.getExclusiveDurationInMillis()
    , transaction = segment.trace.transaction
    , type        = transaction.isWeb() ? DB.WEB : DB.OTHER
    , operation   = DB.OPERATION + &#x27;/&#x27; + this.type + &#x27;/&#x27; + this.operation
    , model       = DB.STATEMENT + &#x27;/&#x27; + this.type +
                      &#x27;/&#x27; + this.model + &#x27;/&#x27; + this.operation
    ;

  // Database/update
  var globalOperation   = DB.PREFIX + this.operation;

  if (scope) transaction.measure(model, scope, duration, exclusive);

  transaction.measure(model,     null, duration, exclusive);
  transaction.measure(operation, null, duration, exclusive);
  transaction.measure(type,      null, duration, exclusive);
  transaction.measure(DB.ALL,    null, duration, exclusive);

  transaction.measure(globalOperation,    null, duration, exclusive);

  if (segment.port &#x3e; 0) {
    var hostname = segment.host || &#x27;localhost&#x27;
      , location = hostname + &#x27;:&#x27; + segment.port
      , instance = DB.INSTANCE + &#x27;/&#x27; + this.type + &#x27;/&#x27; + location
      ;

    transaction.measure(instance, null, duration, exclusive);
  }

  if( this.raw ) { // If the ParsedStatment contains a raw SQL statement, add it to the agent&#x27;s QueryTracer
    transaction.agent.queries.addQuery( segment, this.type.toLowerCase(), this.raw, this.trace );
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.reservoir" id="apidoc.module.oneapm.reservoir">module oneapm.reservoir</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.reservoir.reservoir" id="apidoc.element.oneapm.reservoir.reservoir">
        function <span class="apidocSignatureSpan">oneapm.</span>reservoir
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Reservoir() {
  this.limit = 10;
  this._size = 0;
  this._data = [];

  this.Random = Math.random;
  this.Floor  = Math.floor;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.reservoir.prototype" id="apidoc.module.oneapm.reservoir.prototype">module oneapm.reservoir.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.reservoir.prototype.add" id="apidoc.element.oneapm.reservoir.prototype.add">
        function <span class="apidocSignatureSpan">oneapm.reservoir.prototype.</span>add
        <span class="apidocSignatureSpan">(item)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(item) {
  var k = this.limit;
  var i = this._size ++;

  if (i &#x3c; k) {
    this._data.push(item);
  } else {
    var j = this.Floor(this.Random() * (i + 2));
    if (j &#x3c; k) this._data[j] = item;
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Error}  error            The error to be traced.
* @param {object} customParameters Any custom parameters to be displayed in
*                                  the OneAPM UI.
*/
API.prototype.noticeError = function noticeError(error, customParameters) {
 if (typeof error === &#x27;string&#x27;) error = new Error(error);
 var transaction = this.agent.tracer.getTransaction();
 this.agent.errors.<span class="apidocCodeKeywordSpan">add</span>(transaction, error, customParameters);
};

/**
* If the URL for a transaction matches the provided pattern, name the
* transaction with the provided name. If there are capture groups in the
* pattern (which is a standard JavaScript regular expression, and can be
* passed as either a RegExp or a string), then the substring matches ($1, $2,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.reservoir.prototype.overflow" id="apidoc.element.oneapm.reservoir.prototype.overflow">
        function <span class="apidocSignatureSpan">oneapm.reservoir.prototype.</span>overflow
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function overflow() {
  var diff = this._size - this.limit;
  return diff &#x3e;= 0 ? diff : 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var newlimit = agent.config.transaction_events.max_samples_stored;
  agent.events.limit = newlimit;

  for(var k=0; k&#x3c;sample.length; k++) agent.events.add(sample[k]);
}
else {
  // if we had to limit events and sample them, emit a warning
  var diff = events.<span class="apidocCodeKeywordSpan">overflow</span>();
  if (diff &#x3e; 0) logger.warn(
    &#x27;analytics event overflow, dropped %d events; &#x27; +
     &#x27;try increasing your limit above %d&#x27;,
    diff, events.limit
  );
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.reservoir.prototype.toArray" id="apidoc.element.oneapm.reservoir.prototype.toArray">
        function <span class="apidocSignatureSpan">oneapm.reservoir.prototype.</span>toArray
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toArray() {
  return this._data;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  })
}

Agent.prototype._sendEvents = function _sendEvents (callback) {
  if (this.config.transaction_events.enabled) {
var agent  = this;
var events = agent.events;
var sample = events.<span class="apidocCodeKeywordSpan">toArray</span>();
var run_id = agent.config.run_id;

// bail if there are no events
if (sample.length &#x3c; 1) {
  return process.nextTick(callback);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.sampler" id="apidoc.module.oneapm.sampler">module oneapm.sampler</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.sampler.checkEvents" id="apidoc.element.oneapm.sampler.checkEvents">
        function <span class="apidocSignatureSpan">oneapm.sampler.</span>checkEvents
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function checkEvents(agent) {
  return function eventSampler() {
    var timer = new Timer();
    timer.begin();
    setTimeout(recordQueueTime.bind(null, agent, timer), 0);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.sampler.sampleCPU" id="apidoc.element.oneapm.sampler.sampleCPU">
        function <span class="apidocSignatureSpan">oneapm.sampler.</span>sampleCPU
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sampleCPU(agent) {
  var pidusage = require(&#x27;pidusage-fork&#x27;);
  return function CPUSampler() {
    //result is {cpu:percentage ...}
    pidusage.stat(process.pid, function (err, result) {
      if (err) {

      } else {
        var stats = agent.metrics.getOrCreateMetric(NAMES.CPU.USERUtilization);
        stats.recordValue(result.cpu / 100);
      }
    });
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.sampler.sampleMemory" id="apidoc.element.oneapm.sampler.sampleMemory">
        function <span class="apidocSignatureSpan">oneapm.sampler.</span>sampleMemory
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function sampleMemory(agent) {
  return function memorySampler() {
    var mem = process.memoryUsage();
    agent.metrics.measureBytes(NAMES.MEMORY.PHYSICAL, mem.rss);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.sampler.start" id="apidoc.element.oneapm.sampler.start">
        function <span class="apidocSignatureSpan">oneapm.sampler.</span>start
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function start(agent) {
  samplers.push(new Sampler(sampleCPU(agent), 5e3));
  samplers.push(new Sampler(sampleMemory(agent), 5e3));
  samplers.push(new Sampler(checkEvents(agent), 15e3));
  sampler.state = &#x27;running&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (appNames.length &#x3c; 1) {
      throw new Error(locales.AGENT_NO_NAME_ERROR);
    }

    var shimmer = require(&#x27;./lib/shimmer.js&#x27;);
    shimmer.patchModule(agent);
    shimmer.bootstrapInstrumentation(agent);
    agent.<span class="apidocCodeKeywordSpan">start</span>(agent_start_cb);

    API = require(&#x27;./api.js&#x27;);

  }
} catch (error) {
  show_error(error, locales.AGENT_BOOTSTRAP_ERROR);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.sampler.stop" id="apidoc.element.oneapm.sampler.stop">
        function <span class="apidocSignatureSpan">oneapm.sampler.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function stop() {
  samplers.forEach(function cb_forEach(sampler) {
    sampler.stop();
  });
  samplers = [];
  sampler.state = &#x27;stopped&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var cmdData = cmdItem[1];

logger.info(&#x27;remote command received %d : %s&#x27;, cmdId, cmdData)

if (cmdData.name === &#x27;restart&#x27;) {
  logger.info(&#x27;restarting&#x27;);

  agent.<span class="apidocCodeKeywordSpan">stop</span>(function (err) {
    if (err) {
      logger.error(err);
    }
    agent.start(function (err) {
      if (err) {
        logger.error(err);
      }
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.segment" id="apidoc.module.oneapm.segment">module oneapm.segment</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.segment.segment" id="apidoc.element.oneapm.segment.segment">
        function <span class="apidocSignatureSpan">oneapm.</span>segment
        <span class="apidocSignatureSpan">(trace, name, recorder)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TraceSegment(trace, name, recorder) {
  if (!trace) throw new Error(&#x27;Trace segments must be bound to a transaction trace.&#x27;);
  if (!name) throw new Error(&#x27;Trace segments must be named.&#x27;);

  this.trace = trace;
  this.name = name;

  if (recorder) this.trace.addRecorder(recorder.bind(null, this));

  this.parameters = {nr_exclusive_duration_millis : null};
  this.children = [];

  this.timer = new Timer();
  this.timer.begin();

  // hidden class optimization
  this.partialName = null;
  this._exclusiveDuration = null;
  this.host = null;
  this.port = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.segment.prototype" id="apidoc.module.oneapm.segment.prototype">module oneapm.segment.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype._getChildPairs" id="apidoc.element.oneapm.segment.prototype._getChildPairs">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>_getChildPairs
        <span class="apidocSignatureSpan">(end)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _getChildPairs(end) {
  // quick optimization
  if (this.children.length &#x3c; 1) return [];
  if (!end) end = Infinity;

  var seed = this.children.map(function cb_map(segment) {
    return segment.timer.toRange();
  });

  return this.children
    .reduce(function cb_reduce(pairs, segment) {
      return pairs.concat(segment._getChildPairs(end));
    }, seed)
    .filter(function cb_filter(pair) {
      return pair[0] &#x3c; end;
    })
    .map(function cb_map(pair) {
      // FIXME: heuristically limit intervals to the end of the parent segment
      return [pair[0], Math.min(pair[1], end)];
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

 var total = this.getDurationInMillis()
   , end   = this.timer.toRange()[1]
   ;

 if (this.children.length &#x3e; 0) {
   // convert the list of start, duration pairs to start, end pairs
   total -= sumChildren(this.<span class="apidocCodeKeywordSpan">_getChildPairs</span>(end));
 }

 return total;
};

/**
* Enumerate the timings of this segment&#x27;s descendents.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype._setExclusiveDurationInMillis" id="apidoc.element.oneapm.segment.prototype._setExclusiveDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>_setExclusiveDurationInMillis
        <span class="apidocSignatureSpan">(duration)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _setExclusiveDurationInMillis(duration) {
  this._exclusiveDuration = duration;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.add" id="apidoc.element.oneapm.segment.prototype.add">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>add
        <span class="apidocSignatureSpan">(childName, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(childName, callback) {
  var segment = new TraceSegment(this.trace, childName, callback);
  this.children.push(segment);
  return segment;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Error}  error            The error to be traced.
* @param {object} customParameters Any custom parameters to be displayed in
*                                  the OneAPM UI.
*/
API.prototype.noticeError = function noticeError(error, customParameters) {
 if (typeof error === &#x27;string&#x27;) error = new Error(error);
 var transaction = this.agent.tracer.getTransaction();
 this.agent.errors.<span class="apidocCodeKeywordSpan">add</span>(transaction, error, customParameters);
};

/**
* If the URL for a transaction matches the provided pattern, name the
* transaction with the provided name. If there are capture groups in the
* pattern (which is a standard JavaScript regular expression, and can be
* passed as either a RegExp or a string), then the substring matches ($1, $2,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.end" id="apidoc.element.oneapm.segment.prototype.end">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end() {
  if (!this.timer.isActive()) return;

  this.timer.end();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.<span class="apidocCodeKeywordSpan">end</span>();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.getDurationInMillis" id="apidoc.element.oneapm.segment.prototype.getDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>getDurationInMillis
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDurationInMillis() {
  return this.timer.getDurationInMillis();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/* If we&#x27;re in an unnamed transaction, add a friendly warning this is to
 * avoid people going crazy, trying to figure out why browser monitoring is
 * not working when they&#x27;re missing a transaction name.
 */
if (!name) return _gracefail(3);

var time  = trans.timer.<span class="apidocCodeKeywordSpan">getDurationInMillis</span>();
var key   = config.license_key;
var appid = config.application_id;

/* This is only going to work if the agent has successfully handshaked with
 * the collector. If the networks is bad, or there is no license key set in
 * oneapm.js, there will be no application_id set.  We bail instead of
 * outputting null/undefined configuration values.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.getExclusiveDurationInMillis" id="apidoc.element.oneapm.segment.prototype.getExclusiveDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>getExclusiveDurationInMillis
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getExclusiveDurationInMillis() {
  if (this._exclusiveDuration) return this._exclusiveDuration;

  var total = this.getDurationInMillis()
    , end   = this.timer.toRange()[1]
    ;

  if (this.children.length &#x3e; 0) {
    // convert the list of start, duration pairs to start, end pairs
    total -= sumChildren(this._getChildPairs(end));
  }

  return total;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.type      = type;
this.operation = operation;
this.model     = model;
}

ParsedStatement.prototype.recordMetrics = function recordMetrics(segment, scope) {
var duration    = segment.getDurationInMillis()
  , exclusive   = segment.<span class="apidocCodeKeywordSpan">getExclusiveDurationInMillis</span>()
  , transaction = segment.trace.transaction
  , type        = transaction.isWeb() ? DS.WEB : DS.OTHER
  , operation   = DS.OPERATION + &#x27;/&#x27; + this.type + &#x27;/&#x27; + this.operation
  , model       = DS.STATEMENT + &#x27;/&#x27; + this.type +
                    &#x27;/&#x27; + this.model + &#x27;/&#x27; + this.operation
  ;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.markAsWeb" id="apidoc.element.oneapm.segment.prototype.markAsWeb">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>markAsWeb
        <span class="apidocSignatureSpan">(rawURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function markAsWeb(rawURL) {
  var transaction = this.trace.transaction;

  // transaction name and web segment name must match
  this.name = transaction.name;
  // partialName is used to name apdex metrics when recording
  this.partialName = transaction.partialName;

  var config = this.trace.transaction.agent.config;

  // Copy params object so we can modify it before applying it
  // multiple params places. It eventually runs through copyParameters
  // so I&#x27;m not worried about `ignored_params` or `capture_params`.
  var params = util._extend({}, this.parameters);

  // This shouldn&#x27;t be moved from the segment to the trace, so remove it.
  delete params.nr_exclusive_duration_millis;

  // Because we are assured we have the URL here, lets grab query params. Same
  // as above, about to be run through copyParameters, so opt for the faster
  // object merge/copy.
  util._extend(params, urltils.parseParameters(rawURL));

  urltils.copyParameters(config, params, this.parameters);
  urltils.copyParameters(config, params, this.trace.parameters);

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  var segment = tracer.addSegment( THRIFT.PREFIX + k, recordThrift );

  var stack = (new Error()).stack;
  segment.parameters.backtrace = stackUtil.formatStack( stack );

  var result = original.apply( null, arguments );
  //segment.<span class="apidocCodeKeywordSpan">markAsWeb</span>(&#x27;thrift&#x27; + k);
  transaction.end();
  segment.end();
  return result;
} );

// Construct the formal argument list
var argList = [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.setDurationInMillis" id="apidoc.element.oneapm.segment.prototype.setDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>setDurationInMillis
        <span class="apidocSignatureSpan">(duration, start)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setDurationInMillis(duration, start) {
  this.timer.setDurationInMillis(duration, start);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Explicitly set a trace&#x27;s runtime instead of using it as a stopwatch.
 * (As a byproduct, stops the timer.)
 *
 * @param {int} duration Duration of this particular trace.
 * @param {int} startTimeInMillis (optional) Start of this trace.
 */
Trace.prototype.setDurationInMillis = function setDurationInMillis(duration, startTimeInMillis) {
this.root.<span class="apidocCodeKeywordSpan">setDurationInMillis</span>(duration, startTimeInMillis);
};

/**
 * @return {integer} The amount of time the trace took, in milliseconds.
 */
Trace.prototype.getDurationInMillis = function getDurationInMillis() {
return this.root.getDurationInMillis();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.toJSON" id="apidoc.element.oneapm.segment.prototype.toJSON">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toJSON() {
  var start = this.timer.startedRelativeTo(this.trace.root.timer);
  if (!this.parameters.nr_exclusive_duration_millis) {
    this.parameters.nr_exclusive_duration_millis = this.getExclusiveDurationInMillis();
  }

  return [
    start,
    start + this.getDurationInMillis(),
    this.name,
    this.parameters,
    this.children.map(function cb_map(child) { return child.toJSON(); }),
    this.name,
    this.trace.transaction.verb
  ];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.merge(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.<span class="apidocCodeKeywordSpan">toJSON</span>().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}

var metrics      = this.metrics
  , beginSeconds = metrics.started * FROM_MILLIS
  , endSeconds   = Date.now() * FROM_MILLIS
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.segment.prototype.touch" id="apidoc.element.oneapm.segment.prototype.touch">
        function <span class="apidocSignatureSpan">oneapm.segment.prototype.</span>touch
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function touch() {
  this.timer.touch();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
Timer.prototype.getDurationInMillis = function getDurationInMillis() {
if (this.state === PENDING) return 0;

// only set by setDurationInMilis
if (this.durationInMillis &#x3e;= 0) return this.durationInMillis;

// prioritize .end() and .<span class="apidocCodeKeywordSpan">touch</span>()
if (this.hrDuration) {
  return hrToMillis(this.hrDuration);
}
else if (this.duration) {
  return this.duration;
}
// fall back to time elapsed since start
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.sql" id="apidoc.module.oneapm.sql">module oneapm.sql</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.sql.sql" id="apidoc.element.oneapm.sql.sql">
        function <span class="apidocSignatureSpan">oneapm.</span>sql
        <span class="apidocSignatureSpan">(query, transaction, stats)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SQLTrace(query, transaction, stats) {
  if (!query) throw new Error(&#x22;Can&#x27;t create SQL trace without SQL!&#x22;);
  if (!transaction) throw new Error(&#x22;Can&#x27;t create SQL trace without transaction.&#x22;);
  if (!stats) throw new Error(&#x22;Can&#x27;t create SQL trace without statistics.&#x22;);

  this.query       = query;
  this.transaction = transaction;
  this.stats       = stats;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.sql.prototype" id="apidoc.module.oneapm.sql.prototype">module oneapm.sql.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.sql.prototype.generateJSON" id="apidoc.element.oneapm.sql.prototype.generateJSON">
        function <span class="apidocSignatureSpan">oneapm.sql.prototype.</span>generateJSON
        <span class="apidocSignatureSpan">(name, params, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateJSON(name, params, callback) {
  codec.encode(params, function cb_encode(err, encoded) {
    if (err) return callback(err);

    return callback(null,
                    [
                      name,
                      this.transaction.url,
                      this.getSQLId(),
                      this.query,
                      this.stats.callCount,
                      this.stats.total,
                      this.stats.min,
                      this.stats.max,
                      encoded
                    ]);
  }.bind(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * @param Function callback The receiver of the encoded trace or errors.
 */
TraceAggregator.prototype.harvest = function harvest(callback) {
// calls out to zlib are asynchronous
if (this.trace) {
  this.noTraceSubmitted = 0;
  this.trace.<span class="apidocCodeKeywordSpan">generateJSON</span>(callback);
}
else {
  this.noTraceSubmitted++;
  if (this.noTraceSubmitted &#x3e;= 5) this.resetTimingTracker();

  process.nextTick(function cb_nextTick() { callback(null, null, null); });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.sql.prototype.getSQLId" id="apidoc.element.oneapm.sql.prototype.getSQLId">
        function <span class="apidocSignatureSpan">oneapm.sql.prototype.</span>getSQLId
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSQLId() {
  var h = 0;

  var buf = new Buffer(this.query);
  var len = buf.length;
  for (var i = 0; i &#x3c; len; i++) {
    h = 31 * h + buf.readUInt8(i);
    h = h &#x26; 0xFFFFFFFF;
  }
  return h;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  codec.encode(params, function cb_encode(err, encoded) {
if (err) return callback(err);

return callback(null,
                [
                  name,
                  this.transaction.url,
                  this.<span class="apidocCodeKeywordSpan">getSQLId</span>(),
                  this.query,
                  this.stats.callCount,
                  this.stats.total,
                  this.stats.min,
                  this.stats.max,
                  encoded
                ]);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.stack" id="apidoc.module.oneapm.stack">module oneapm.stack</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.stack.formatStack" id="apidoc.element.oneapm.stack.formatStack">
        function <span class="apidocSignatureSpan">oneapm.stack.</span>formatStack
        <span class="apidocSignatureSpan">(stack)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function formatStack(stack) {
  if( !stack ) return &#x27;&#x27;;
  // remove error message and instrumentation frames from stack trace
  return stack.split(&#x27;\n&#x27;).slice(1).filter(notOneAPM).join(&#x27;\n&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function SlowQuery(segment, type, query, trace) {
  this.obfuscated = obfuscate(query, type)
  this.normalized = this.obfuscated.replace(/\?\s*,\s*|\s*/g, &#x27;&#x27;)
  this.id = normalizedHash(this.normalized)
  this.segment = segment
  this.query = query
  this.metric = segment.name
  this.trace = stackUtil.<span class="apidocCodeKeywordSpan">formatStack</span>(trace.stack)  // trace is an Error object, for capturing
 the stack.
  this.duration = segment.getDurationInMillis()
}

function normalizedHash(value) {
  return parseInt(crypto.createHash(&#x27;md5&#x27;).update(value).digest(&#x27;hex&#x27;).slice(-4), 16)
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.statement_matcher" id="apidoc.module.oneapm.statement_matcher">module oneapm.statement_matcher</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.statement_matcher.statement_matcher" id="apidoc.element.oneapm.statement_matcher.statement_matcher">
        function <span class="apidocSignatureSpan">oneapm.</span>statement_matcher
        <span class="apidocSignatureSpan">(operation, operationPattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StatementMatcher(operation, operationPattern) {
  this.operation        = operation;
  this.operationPattern = operationPattern;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.statement_matcher.prototype" id="apidoc.module.oneapm.statement_matcher.prototype">module oneapm.statement_matcher.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.statement_matcher.prototype.getParsedStatement" id="apidoc.element.oneapm.statement_matcher.prototype.getParsedStatement">
        function <span class="apidocSignatureSpan">oneapm.statement_matcher.prototype.</span>getParsedStatement
        <span class="apidocSignatureSpan">(type, sql)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getParsedStatement(type, sql) {
  this.operationPattern.lastIndex = 0;

  var match = new RegExp(&#x22;^\\s*&#x22; + this.operation, &#x22;ig&#x22;).test(sql);
  if (match) {
    var queryMatch = this.operationPattern.exec(sql);
    var model = queryMatch ? queryMatch[1] : &#x27;unknown&#x27;;

    return new ParsedStatement(type, this.operation, model, sql);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
;

module.exports = function parseSql(type, sql) {
sql = sql.replace(COMMENT_PATTERN, &#x27;&#x27;).trim();

var parsedStatement;
OPERATIONS.every(function cb_every(op) {
  var ps = op.<span class="apidocCodeKeywordSpan">getParsedStatement</span>(type, sql);
  if (ps) {
    parsedStatement = ps;
    return false;
  }
  else {
    return true;
  }
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.stats" id="apidoc.module.oneapm.stats">module oneapm.stats</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.stats.stats" id="apidoc.element.oneapm.stats.stats">
        function <span class="apidocSignatureSpan">oneapm.</span>stats
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Stats() {
  this.total = 0;
  this.totalExclusive = 0;
  this.min = 0;
  this.max = 0;
  this.sumOfSquares = 0;
  this.callCount = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.stats.prototype" id="apidoc.module.oneapm.stats.prototype">module oneapm.stats.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.stats.prototype.incrementCallCount" id="apidoc.element.oneapm.stats.prototype.incrementCallCount">
        function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>incrementCallCount
        <span class="apidocSignatureSpan">(count)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function incrementCallCount(count) {
  if (typeof count === &#x27;undefined&#x27;) count = 1;
  this.callCount += count;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @param {Function} callback Gets any delivery errors.
 */
Agent.prototype._sendMetrics = function _sendMetrics(callback) {
  var agent = this;

  if (this.collector.isConnected()) {
if (this.errors.errorCount &#x3e; 0) {
  this.metrics.getOrCreateMetric(NAMES.ERRORS.ALL).<span class="apidocCodeKeywordSpan">incrementCallCount</span>(this.errors.errorCount
);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.WEB).incrementCallCount(this.errors.errorWebCount);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.OTHER).incrementCallCount(this.errors.errorOtherCount);
}


// merge internal metrics and send them
if (this.config.debug.supportability) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stats.prototype.merge" id="apidoc.element.oneapm.stats.prototype.merge">
        function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>merge
        <span class="apidocSignatureSpan">(other)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function merge(other) {
  if (other.callCount &#x3e; 0) {
    if (this.callCount &#x3e; 0) {
      this.min = Math.min(this.min, other.min);
    }
    else {
      this.min = other.min;
    }
  }
  this.max = Math.max(this.max, other.max);

  this.total          += other.total;
  this.totalExclusive += other.totalExclusive;
  this.sumOfSquares   += other.sumOfSquares;
  this.callCount      += other.callCount;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.metrics.getOrCreateMetric(NAMES.ERRORS.WEB).incrementCallCount(this.errors.errorWebCount);
  this.metrics.getOrCreateMetric(NAMES.ERRORS.OTHER).incrementCallCount(this.errors.errorOtherCount);
}


// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.<span class="apidocCodeKeywordSpan">merge</span>(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.toJSON().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stats.prototype.recordValue" id="apidoc.element.oneapm.stats.prototype.recordValue">
        function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>recordValue
        <span class="apidocSignatureSpan">(totalTime, exclusiveTime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordValue(totalTime, exclusiveTime) {
  // even if a caller messes up, don&#x27;t break everything else
  if (totalTime !== 0 &#x26;&#x26; !totalTime) totalTime = 0;
  if (exclusiveTime !== 0 &#x26;&#x26; !exclusiveTime) exclusiveTime = totalTime;

  if (this.callCount &#x3e; 0) {
    this.min = Math.min(totalTime, this.min);
  }
  else {
    this.min = totalTime;
  }
  this.max = Math.max(totalTime, this.max);

  this.sumOfSquares   += (totalTime * totalTime);
  this.callCount      += 1;
  this.total          += totalTime;
  this.totalExclusive += exclusiveTime;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
return function CPUSampler() {
  //result is {cpu:percentage ...}
  pidusage.stat(process.pid, function (err, result) {
    if (err) {

    } else {
      var stats = agent.metrics.getOrCreateMetric(NAMES.CPU.USERUtilization);
      stats.<span class="apidocCodeKeywordSpan">recordValue</span>(result.cpu / 100);
    }
  });
};
}

function sampleMemory(agent) {
return function memorySampler() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stats.prototype.recordValueInBytes" id="apidoc.element.oneapm.stats.prototype.recordValueInBytes">
        function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>recordValueInBytes
        <span class="apidocSignatureSpan">(bytes, exclusiveBytes)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordValueInBytes(bytes, exclusiveBytes) {
  exclusiveBytes = exclusiveBytes || bytes;
  this.recordValue(bytes / BYTES_PER_MB, exclusiveBytes / BYTES_PER_MB);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
*
* @param {string} name The name of the metric.
* @param {Number} size The size of the related operation, in bytes.
* @return {Stats} The aggregated data related to this metric.
*/
Metrics.prototype.measureBytes = function measureBytes(name, size) {
 var stats = this.getOrCreateMetric(name);
 stats.<span class="apidocCodeKeywordSpan">recordValueInBytes</span>(size);
 return stats;
};

/**
* Look up the mapping from a name (and optionally a scope) to a set of metric
* data for that name, creating the data if they don&#x27;t already exist.
*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stats.prototype.recordValueInMillis" id="apidoc.element.oneapm.stats.prototype.recordValueInMillis">
        function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>recordValueInMillis
        <span class="apidocSignatureSpan">(totalTime, exclusiveTime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function recordValueInMillis(totalTime, exclusiveTime) {
  this.recordValue(totalTime * FROM_MILLIS,
                   exclusiveTime &#x3e;= 0 ? exclusiveTime * FROM_MILLIS : null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Number} duration The duration of the related operation, in milliseconds.
* @param {Number} exclusive (Optional) The portion of the operation specific to this
*                           metric.
* @return {Stats} The aggregated data related to this metric.
*/
Metrics.prototype.measureMilliseconds = function measureMilliseconds(name, scope, duration, exclusive) {
 var stats = this.getOrCreateMetric(name, scope);
 stats.<span class="apidocCodeKeywordSpan">recordValueInMillis</span>(duration, exclusive);
 return stats;
};

/**
* Set the size of an operation. If there are no data for the name existing,
* the collection will create a set of data before recording the measurement.
*
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stats.prototype.toJSON" id="apidoc.element.oneapm.stats.prototype.toJSON">
        function <span class="apidocSignatureSpan">oneapm.stats.prototype.</span>toJSON
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toJSON() {
  return [
    this.callCount,
    this.total,
    this.totalExclusive,
    this.min,
    this.max,
    this.sumOfSquares
  ];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// merge internal metrics and send them
if (this.config.debug.supportability) {
  this.metrics.merge(this.config.debug.supportability);
}

// wait to check until all the standard stuff has been added
if (this.metrics.<span class="apidocCodeKeywordSpan">toJSON</span>().length &#x3c; 1) {
  logger.debug(&#x22;No metrics to send.&#x22;);
  return process.nextTick(callback);
}

var metrics      = this.metrics
  , beginSeconds = metrics.started * FROM_MILLIS
  , endSeconds   = Date.now() * FROM_MILLIS
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.stream_sink" id="apidoc.module.oneapm.stream_sink">module oneapm.stream_sink</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.stream_sink.stream_sink" id="apidoc.element.oneapm.stream_sink.stream_sink">
        function <span class="apidocSignatureSpan">oneapm.</span>stream_sink
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function StreamSink(callback) {
  EventEmitter.call(this);

  this.callback = callback;
  this.sink = &#x27;&#x27;;
  this.writable = true;

  var sink = this;
  this.on(&#x27;error&#x27;, function handle_error(error) {
    sink.writable = false;
    callback(error);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stream_sink.super_" id="apidoc.element.oneapm.stream_sink.super_">
        function <span class="apidocSignatureSpan">oneapm.stream_sink.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.stream_sink.prototype" id="apidoc.module.oneapm.stream_sink.prototype">module oneapm.stream_sink.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.stream_sink.prototype.destroy" id="apidoc.element.oneapm.stream_sink.prototype.destroy">
        function <span class="apidocSignatureSpan">oneapm.stream_sink.prototype.</span>destroy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function destroy() {
  this.emit(&#x27;close&#x27;);
  this.writable = false;

  delete this.sink;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stream_sink.prototype.end" id="apidoc.element.oneapm.stream_sink.prototype.end">
        function <span class="apidocSignatureSpan">oneapm.stream_sink.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end() {
  this.writable = false;

  this.callback(null, this.sink);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.<span class="apidocCodeKeywordSpan">end</span>();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.stream_sink.prototype.write" id="apidoc.element.oneapm.stream_sink.prototype.write">
        function <span class="apidocSignatureSpan">oneapm.stream_sink.prototype.</span>write
        <span class="apidocSignatureSpan">(string)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function write(string) {
  if (!this.writable) {
    this.emit(&#x27;error&#x27;, new Error(&#x22;Sink no longer writable!&#x22;));
    return false;
  }

  // Explicitly copy buffer contents so we are sure to release references to
  // the TLS slab buffer region.
  // I guess it is a potential bottle neck, because we are doing lots of string concat here
  this.sink += string.toString();

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.timer" id="apidoc.module.oneapm.timer">module oneapm.timer</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.timer.timer" id="apidoc.element.oneapm.timer.timer">
        function <span class="apidocSignatureSpan">oneapm.</span>timer
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Timer() {
  this.state = PENDING;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.timer.prototype" id="apidoc.module.oneapm.timer.prototype">module oneapm.timer.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.begin" id="apidoc.element.oneapm.timer.prototype.begin">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>begin
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function begin() {
  if (this.state &#x3e; PENDING) return;

  this.start = Date.now();
  // need to put a guard on this for compatibility with Node &#x3c; 0.8
  if (process.hrtime) this.hrstart = process.hrtime();
  this.state = RUNNING;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  agent.metrics.measureBytes(NAMES.MEMORY.PHYSICAL, mem.rss);
};
}

function checkEvents(agent) {
return function eventSampler() {
  var timer = new Timer();
  timer.<span class="apidocCodeKeywordSpan">begin</span>();
  setTimeout(recordQueueTime.bind(null, agent, timer), 0);
};
}

var sampler = {
state: &#x27;stopped&#x27;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.end" id="apidoc.element.oneapm.timer.prototype.end">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end() {
  if (this.state &#x3e; RUNNING) return;

  if (process.hrtime) this.hrDuration = process.hrtime(this.hrstart);
  this.duration = Date.now() - this.start;
  this.state = STOPPED;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.<span class="apidocCodeKeywordSpan">end</span>();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.getDurationInMillis" id="apidoc.element.oneapm.timer.prototype.getDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>getDurationInMillis
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDurationInMillis() {
  if (this.state === PENDING) return 0;

  // only set by setDurationInMilis
  if (this.durationInMillis &#x3e;= 0) return this.durationInMillis;

  // prioritize .end() and .touch()
  if (this.hrDuration) {
    return hrToMillis(this.hrDuration);
  }
  else if (this.duration) {
    return this.duration;
  }
  // fall back to time elapsed since start
  else if (process.hrtime) {
    return hrToMillis(process.hrtime(this.hrstart));
  }
  else {
    return Date.now() - this.start;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/* If we&#x27;re in an unnamed transaction, add a friendly warning this is to
 * avoid people going crazy, trying to figure out why browser monitoring is
 * not working when they&#x27;re missing a transaction name.
 */
if (!name) return _gracefail(3);

var time  = trans.timer.<span class="apidocCodeKeywordSpan">getDurationInMillis</span>();
var key   = config.license_key;
var appid = config.application_id;

/* This is only going to work if the agent has successfully handshaked with
 * the collector. If the networks is bad, or there is no license key set in
 * oneapm.js, there will be no application_id set.  We bail instead of
 * outputting null/undefined configuration values.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.isActive" id="apidoc.element.oneapm.timer.prototype.isActive">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>isActive
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isActive() {
  return this.state &#x3c; STOPPED;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return this.url ? true : false;
};

/**
 * @return {bool} Is this transaction still alive?
 */
Transaction.prototype.isActive = function isActive() {
  return this.timer.<span class="apidocCodeKeywordSpan">isActive</span>();
};

/**
 * Close out the current transaction and its associated trace. Remove any
 * instances of this transaction annotated onto the call stack.
 */
Transaction.prototype.end = function end() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.isRunning" id="apidoc.element.oneapm.timer.prototype.isRunning">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>isRunning
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isRunning() {
  return this.state === RUNNING;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.setDurationInMillis" id="apidoc.element.oneapm.timer.prototype.setDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>setDurationInMillis
        <span class="apidocSignatureSpan">(duration, start)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setDurationInMillis(duration, start) {
  if (this.state &#x3e; RUNNING) return;
  this.state = STOPPED;

  this.durationInMillis = duration;
  if (start || start === 0) {
    this.hrstart = [Math.floor(start / 1e3), start * 1e6];
    this.start = start;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Explicitly set a trace&#x27;s runtime instead of using it as a stopwatch.
 * (As a byproduct, stops the timer.)
 *
 * @param {int} duration Duration of this particular trace.
 * @param {int} startTimeInMillis (optional) Start of this trace.
 */
Trace.prototype.setDurationInMillis = function setDurationInMillis(duration, startTimeInMillis) {
this.root.<span class="apidocCodeKeywordSpan">setDurationInMillis</span>(duration, startTimeInMillis);
};

/**
 * @return {integer} The amount of time the trace took, in milliseconds.
 */
Trace.prototype.getDurationInMillis = function getDurationInMillis() {
return this.root.getDurationInMillis();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.startedRelativeTo" id="apidoc.element.oneapm.timer.prototype.startedRelativeTo">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>startedRelativeTo
        <span class="apidocSignatureSpan">(other)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function startedRelativeTo(other) {
  if (this.hrstart &#x26;&#x26; other.hrstart &#x26;&#x26; process.hrtime) {
    var s  = this.hrstart[0] - other.hrstart[0]
      , ns = this.hrstart[1] - other.hrstart[1]
      ;

    return hrToMillis([s, ns]);
  }
  else {
    return this.start - other.start;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * in Python:
 * 5: a &#x22;label&#x22;
 *
 * FIXME: I don&#x27;t know if it makes sense to add custom fields for Node. TBD
 */
TraceSegment.prototype.toJSON = function toJSON() {
var start = this.timer.<span class="apidocCodeKeywordSpan">startedRelativeTo</span>(this.trace.root.timer);
if (!this.parameters.nr_exclusive_duration_millis) {
  this.parameters.nr_exclusive_duration_millis = this.getExclusiveDurationInMillis();
}

return [
  start,
  start + this.getDurationInMillis(),
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.toRange" id="apidoc.element.oneapm.timer.prototype.toRange">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>toRange
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toRange() {
  return [this.start, this.start + this.getDurationInMillis()];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * @return {integer} The amount of time the trace took, minus any child
 *                   segments, in milliseconds.
 */
TraceSegment.prototype.getExclusiveDurationInMillis = function getExclusiveDurationInMillis() {
if (this._exclusiveDuration) return this._exclusiveDuration;

var total = this.getDurationInMillis()
  , end   = this.timer.<span class="apidocCodeKeywordSpan">toRange</span>()[1]
  ;

if (this.children.length &#x3e; 0) {
  // convert the list of start, duration pairs to start, end pairs
  total -= sumChildren(this._getChildPairs(end));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.timer.prototype.touch" id="apidoc.element.oneapm.timer.prototype.touch">
        function <span class="apidocSignatureSpan">oneapm.timer.prototype.</span>touch
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function touch() {
  if (this.state &#x3e; RUNNING) return;

  if (process.hrtime) this.hrDuration = process.hrtime(this.hrstart);
  this.duration = Date.now() - this.start;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 */
Timer.prototype.getDurationInMillis = function getDurationInMillis() {
if (this.state === PENDING) return 0;

// only set by setDurationInMilis
if (this.durationInMillis &#x3e;= 0) return this.durationInMillis;

// prioritize .end() and .<span class="apidocCodeKeywordSpan">touch</span>()
if (this.hrDuration) {
  return hrToMillis(this.hrDuration);
}
else if (this.duration) {
  return this.duration;
}
// fall back to time elapsed since start
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.trace" id="apidoc.module.oneapm.trace">module oneapm.trace</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.trace.trace" id="apidoc.element.oneapm.trace.trace">
        function <span class="apidocSignatureSpan">oneapm.</span>trace
        <span class="apidocSignatureSpan">(transaction)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Trace(transaction) {
  if (!transaction) throw new Error(&#x27;All traces must be associated with a transaction.&#x27;);

  this.transaction = transaction;
  this.recorders = [];

  this.root = new Segment(this, &#x27;ROOT&#x27;);

  this.custom = {};

  // hidden class optimization
  this.parameters = {};
  this.domain     = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 // the complete header to be written to the browser
 var out = util.format(
   RUM_STUB,
   json,
   injectScript(js_agent_loader,config)
 );

 logger.<span class="apidocCodeKeywordSpan">trace</span>(&#x27;generating RUM header&#x27;, out);

 return out;
};

/**
* This creates a new segment with the passed in name. It then wraps the
* callback and binds it to the current transaction and segment so any further
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.trace.prototype" id="apidoc.module.oneapm.trace.prototype">module oneapm.trace.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.add" id="apidoc.element.oneapm.trace.prototype.add">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>add
        <span class="apidocSignatureSpan">(childName, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function add(childName, callback) {
  return this.root.add(childName, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* @param {Error}  error            The error to be traced.
* @param {object} customParameters Any custom parameters to be displayed in
*                                  the OneAPM UI.
*/
API.prototype.noticeError = function noticeError(error, customParameters) {
 if (typeof error === &#x27;string&#x27;) error = new Error(error);
 var transaction = this.agent.tracer.getTransaction();
 this.agent.errors.<span class="apidocCodeKeywordSpan">add</span>(transaction, error, customParameters);
};

/**
* If the URL for a transaction matches the provided pattern, name the
* transaction with the provided name. If there are capture groups in the
* pattern (which is a standard JavaScript regular expression, and can be
* passed as either a RegExp or a string), then the substring matches ($1, $2,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.addRecorder" id="apidoc.element.oneapm.trace.prototype.addRecorder">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>addRecorder
        <span class="apidocSignatureSpan">(recorder)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addRecorder(recorder) {
  this.recorders.push(recorder);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var ps = parseSql(MYSQL2.PREFIX, sqlStr)
  , wrapped = tracer.callbackProxy(actualCallback)
  , name = MYSQL2.STATEMENT + ps.model + &#x27;/&#x27; + ps.operation
  , segment = tracer.addSegment(name, ps.recordMetrics.bind(ps))
  ;

tracer.getTransaction().<span class="apidocCodeKeywordSpan">addRecorder</span>( ps.recordMetrics.bind( ps, segment ) );
// capture connection info for datastore instance metric
if (this.config) {
  segment.port = this.config.port;
  segment.host = this.config.host;
}

logger.trace(&#x22;Adding node-mysql 2 query trace segment on transaction %d.&#x22;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.end" id="apidoc.element.oneapm.trace.prototype.end">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end() {
  this.root.end();
  this.record();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.<span class="apidocCodeKeywordSpan">end</span>();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.generateJSON" id="apidoc.element.oneapm.trace.prototype.generateJSON">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>generateJSON
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateJSON(callback) {
  var rootNode = [
    this.root.timer.start * FROM_MILLIS,
    {}, // moved to agentAttributes
    {
      // hint to RPM for how to display this trace&#x27;s segments
      // nr_flatten_leading: false
    }, // moved to userAttributes
    this.root.toJSON(),
    {
      agentAttributes : this.parameters,
      userAttributes  : this.custom,
      intrinsics      : {}
    },
    []  // FIXME: parameter groups
  ];

  var trace = this;
  codec.encode(rootNode, function cb_encode(err, encoded) {
    if (err) return callback(err, null, null);

    var json = [
      trace.root.timer.start,
      trace.getDurationInMillis(),
      trace.transaction.name,
      trace.transaction.url,
      encoded,
      &#x27;&#x27;,   // FIXME: RUM
      null, // NOTE: reserved for future use
      false // FIXME: RUM2
    ];

    return callback(null, json, trace);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * @param Function callback The receiver of the encoded trace or errors.
 */
TraceAggregator.prototype.harvest = function harvest(callback) {
// calls out to zlib are asynchronous
if (this.trace) {
  this.noTraceSubmitted = 0;
  this.trace.<span class="apidocCodeKeywordSpan">generateJSON</span>(callback);
}
else {
  this.noTraceSubmitted++;
  if (this.noTraceSubmitted &#x3e;= 5) this.resetTimingTracker();

  process.nextTick(function cb_nextTick() { callback(null, null, null); });
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.getDurationInMillis" id="apidoc.element.oneapm.trace.prototype.getDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>getDurationInMillis
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getDurationInMillis() {
  return this.root.getDurationInMillis();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/* If we&#x27;re in an unnamed transaction, add a friendly warning this is to
 * avoid people going crazy, trying to figure out why browser monitoring is
 * not working when they&#x27;re missing a transaction name.
 */
if (!name) return _gracefail(3);

var time  = trans.timer.<span class="apidocCodeKeywordSpan">getDurationInMillis</span>();
var key   = config.license_key;
var appid = config.application_id;

/* This is only going to work if the agent has successfully handshaked with
 * the collector. If the networks is bad, or there is no license key set in
 * oneapm.js, there will be no application_id set.  We bail instead of
 * outputting null/undefined configuration values.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.getExclusiveDurationInMillis" id="apidoc.element.oneapm.trace.prototype.getExclusiveDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>getExclusiveDurationInMillis
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getExclusiveDurationInMillis() {
  return this.root.getExclusiveDurationInMillis();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.type      = type;
this.operation = operation;
this.model     = model;
}

ParsedStatement.prototype.recordMetrics = function recordMetrics(segment, scope) {
var duration    = segment.getDurationInMillis()
  , exclusive   = segment.<span class="apidocCodeKeywordSpan">getExclusiveDurationInMillis</span>()
  , transaction = segment.trace.transaction
  , type        = transaction.isWeb() ? DS.WEB : DS.OTHER
  , operation   = DS.OPERATION + &#x27;/&#x27; + this.type + &#x27;/&#x27; + this.operation
  , model       = DS.STATEMENT + &#x27;/&#x27; + this.type +
                    &#x27;/&#x27; + this.model + &#x27;/&#x27; + this.operation
  ;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.record" id="apidoc.element.oneapm.trace.prototype.record">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>record
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function record() {
  var name = this.transaction.name;
  this.recorders.forEach(function cb_forEach(recorder) { recorder(name); }.bind(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/**
* End and close the current trace. Triggers metric recording for trace
* segments that support recording.
*/
Trace.prototype.end = function end() {
 this.root.end();
 this.<span class="apidocCodeKeywordSpan">record</span>();
};

/**
* The instrumentation associates metrics with the different kinds of trace
* segments. The metrics recorders are dependent on the transaction name to
* collect their scoped metrics, and so must wait for the transaction&#x27;s
* name to be finalized before the recording process. Segments are only
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.trace.prototype.setDurationInMillis" id="apidoc.element.oneapm.trace.prototype.setDurationInMillis">
        function <span class="apidocSignatureSpan">oneapm.trace.prototype.</span>setDurationInMillis
        <span class="apidocSignatureSpan">(duration, startTimeInMillis)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setDurationInMillis(duration, startTimeInMillis) {
  this.root.setDurationInMillis(duration, startTimeInMillis);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Explicitly set a trace&#x27;s runtime instead of using it as a stopwatch.
 * (As a byproduct, stops the timer.)
 *
 * @param {int} duration Duration of this particular trace.
 * @param {int} startTimeInMillis (optional) Start of this trace.
 */
Trace.prototype.setDurationInMillis = function setDurationInMillis(duration, startTimeInMillis) {
this.root.<span class="apidocCodeKeywordSpan">setDurationInMillis</span>(duration, startTimeInMillis);
};

/**
 * @return {integer} The amount of time the trace took, in milliseconds.
 */
Trace.prototype.getDurationInMillis = function getDurationInMillis() {
return this.root.getDurationInMillis();
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.tracer" id="apidoc.module.oneapm.tracer">module oneapm.tracer</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.tracer.tracer" id="apidoc.element.oneapm.tracer.tracer">
        function <span class="apidocSignatureSpan">oneapm.</span>tracer
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Tracer(agent) {
  if (!agent) throw new Error(&#x22;Must be initialized with an agent.&#x22;);

  this.agent = agent;

  _patchErrorTracerOntoCLS(agent, namespace);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.tracer.prototype" id="apidoc.module.oneapm.tracer.prototype">module oneapm.tracer.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.addSegment" id="apidoc.element.oneapm.tracer.prototype.addSegment">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>addSegment
        <span class="apidocSignatureSpan">(name, recorder)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addSegment(name, recorder) {
  var current = namespace.get(&#x27;segment&#x27;);
  var segment = current.add(name, recorder);
  namespace.set(&#x27;segment&#x27;, segment);

  return segment;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
API.prototype.createSegment = function createSegment(name, callback) {
  // FLAG: custom_instrumentation
  if (!this.agent.config.feature_flag.custom_instrumentation) {
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.<span class="apidocCodeKeywordSpan">addSegment</span>(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.end();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.bindEmitter" id="apidoc.element.oneapm.tracer.prototype.bindEmitter">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>bindEmitter
        <span class="apidocSignatureSpan">(emitter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function bindEmitter(emitter) {
  namespace.bindEmitter(emitter);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* appropriately. CLS will take care of the necessary monkeypatching (which is
* kinda gross and slow, but unavoidable without a more general way of bridging
* synchronous emitters and asynchronous CLS).
*
* @param {EventEmitter} emitter The emitter to be put onto the CLS context.
*/
Tracer.prototype.bindEmitter = function bindEmitter(emitter) {
 namespace.<span class="apidocCodeKeywordSpan">bindEmitter</span>(emitter);
};

/**
* Some instrumented modules make self calls from instrumented functions to
* instrumented functions.  Because developers can&#x27;t do anything about these
* subsidiary calls, and in most cases won&#x27;t even know they&#x27;re there, it
* doesn&#x27;t make sense to put them on the transaction trace. The instrumentation
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.callbackProxy" id="apidoc.element.oneapm.tracer.prototype.callbackProxy">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>callbackProxy
        <span class="apidocSignatureSpan">(handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function callbackProxy(handler) {
  // if there&#x27;s no handler, there&#x27;s nothing to proxy.
  if (!handler) return;

  // don&#x27;t implicitly create transactions
  if (!this.getTransaction()) return handler;

  var wrapped = namespace.bind(handler, namespace.createContext());
  wrapped[ORIGINAL] = handler;

  return wrapped;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // FLAG: custom_instrumentation
  if (!this.agent.config.feature_flag.custom_instrumentation) {
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.<span class="apidocCodeKeywordSpan">callbackProxy</span>(function () {
    callback.apply(this, arguments);
    segment.end();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.getSegment" id="apidoc.element.oneapm.tracer.prototype.getSegment">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>getSegment
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getSegment() {
  return namespace.get(&#x27;segment&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function wrapMatchRequest(version, matchRequest) {
  return function cls_wrapMatchRequest() {
    if (!tracer.getTransaction()) {
      logger.trace(&#x22;Express %d router called outside transaction.&#x22;, version);
      return matchRequest.apply(this, arguments);
    }
    var route = matchRequest.apply(this, arguments);
    nameFromRoute(tracer.<span class="apidocCodeKeywordSpan">getSegment</span>(), route);
    return route;
  };
}

function wrapProcessParams(version, process_params) {
  return function cls_wrapProcessParams() {
    var transaction=tracer.getTransaction();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.getTransaction" id="apidoc.element.oneapm.tracer.prototype.getTransaction">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>getTransaction
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getTransaction() {
  var transaction = namespace.get(&#x27;transaction&#x27;);
  if (transaction &#x26;&#x26; transaction.isActive()) return transaction;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * from within HTTP or HTTPS listener functions, Express routes, or other
 * contexts where a web request or response object are in scope.
 *
 * @param {string} name The name you want to give the web request in the OneAPM
 *                      UI. Will be prefixed with &#x27;Custom/&#x27; when sent.
 */
API.prototype.setTransactionName = function setTransactionName(name) {
var transaction = this.agent.tracer.<span class="apidocCodeKeywordSpan">getTransaction</span>();
if (!transaction) {
  return logger.warn(&#x22;No transaction found when setting name to &#x27;%s&#x27;.&#x22;, name);
}

if (!name) {
  if (transaction.url) {
    logger.error(&#x22;Must include name in setTransactionName call for URL %s.&#x22;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.isCurrentSegmentType" id="apidoc.element.oneapm.tracer.prototype.isCurrentSegmentType">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>isCurrentSegmentType
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isCurrentSegmentType(type) {
  return namespace.get(TYPE) === type;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
          logger.trace(&#x22;Tracing MongoDB %s.%s(%j).&#x22;, collection, operation, terms);

          /* Don&#x27;t add segments when MongoDB is calling back into itself.
           * Mildly heuristic: MongoDB operations that self-call do so on the
           * same tick, so if a MongoDB operation has already happened this
           * tick (according to the tracer), then it&#x27;s a self-call.
           */
          if (!tracer.<span class="apidocCodeKeywordSpan">isCurrentSegmentType</span>(MONGODB.PREFIX)) {
tracer.setCurrentSegmentType(MONGODB.PREFIX);
var transaction = tracer.getTransaction(),
  segment = addMongoStatement(tracer, collection, operation);

if (typeof terms === &#x27;object&#x27;) {
  urltils.copyParameters(agent.config, terms, segment.parameters);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.segmentProxy" id="apidoc.element.oneapm.tracer.prototype.segmentProxy">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>segmentProxy
        <span class="apidocSignatureSpan">(handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function segmentProxy(handler) {
  // if there&#x27;s no handler, there&#x27;s nothing to proxy.
  if (!handler) return;

  var self = this;
  var wrapped = function wrapSegmentInvocation() {
    // don&#x27;t implicitly create transactions
    if (!self.getTransaction()) return handler.apply(this, arguments);

    return namespace.bind(handler, namespace.createContext()).apply(this, arguments);
  };
  wrapped[ORIGINAL] = handler;

  return wrapped;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
module.exports = function initialize(agent, memcached) {
  var tracer = agent.tracer;

  shimmer.wrapMethod(memcached &#x26;&#x26; memcached.prototype,
               &#x27;memcached.prototype&#x27;,
               &#x27;command&#x27;,
               function cb_wrapMethod(command) {
    return tracer.<span class="apidocCodeKeywordSpan">segmentProxy</span>(function cb_segmentProxy() {
if (!tracer.getTransaction()) return command.apply(this, arguments);

/* The &#x27;command&#x27; function will be called with a single function argument.
 * That function returns a simple object describing the memcached call.
 * Call that function to get that call description.
 */
var metacall = arguments[0]()
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.setCurrentSegmentType" id="apidoc.element.oneapm.tracer.prototype.setCurrentSegmentType">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>setCurrentSegmentType
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setCurrentSegmentType(type) {
  // only add a cleaner if there isn&#x27;t one set already
  if (!namespace.get(TYPE)) process.nextTick(function cb_nextTick() {
    namespace.set(TYPE, undefined);
  });
  namespace.set(TYPE, type);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

          /* Don&#x27;t add segments when MongoDB is calling back into itself.
           * Mildly heuristic: MongoDB operations that self-call do so on the
           * same tick, so if a MongoDB operation has already happened this
           * tick (according to the tracer), then it&#x27;s a self-call.
           */
          if (!tracer.isCurrentSegmentType(MONGODB.PREFIX)) {
tracer.<span class="apidocCodeKeywordSpan">setCurrentSegmentType</span>(MONGODB.PREFIX);
var transaction = tracer.getTransaction(),
  segment = addMongoStatement(tracer, collection, operation);

if (typeof terms === &#x27;object&#x27;) {
  urltils.copyParameters(agent.config, terms, segment.parameters);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.setSegment" id="apidoc.element.oneapm.tracer.prototype.setSegment">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>setSegment
        <span class="apidocSignatureSpan">(segment)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setSegment(segment) {
  namespace.set(&#x27;segment&#x27;, segment);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    , proxied     = this
    , args        = self.slice(arguments)
    ;

  var returned;
  namespace.bind(function cb_bind() {
    self.setTransaction(transaction);
    self.<span class="apidocCodeKeywordSpan">setSegment</span>(transaction.getTrace().root);
    returned = namespace.bind(handler).apply(proxied, args);
  }, Object.create(null))();

  return returned;
};
wrapped[ORIGINAL] = handler;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.setTransaction" id="apidoc.element.oneapm.tracer.prototype.setTransaction">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>setTransaction
        <span class="apidocSignatureSpan">(transaction)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setTransaction(transaction) {
  namespace.set(&#x27;transaction&#x27;, transaction);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var transaction = self.getTransaction() || new Transaction(self.agent)
    , proxied     = this
    , args        = self.slice(arguments)
    ;

  var returned;
  namespace.bind(function cb_bind() {
    self.<span class="apidocCodeKeywordSpan">setTransaction</span>(transaction);
    self.setSegment(transaction.getTrace().root);
    returned = namespace.bind(handler).apply(proxied, args);
  }, Object.create(null))();

  return returned;
};
wrapped[ORIGINAL] = handler;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.slice" id="apidoc.element.oneapm.tracer.prototype.slice">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>slice
        <span class="apidocSignatureSpan">(args)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function slice(args) {
<span class="apidocCodeCommentSpan">  /**
   * Usefully nerfed version of slice for use in instrumentation. Way faster
   * than using [].slice.call, and maybe putting it in here (instead of the
   * same module context where it will be used) will make it faster by
   * defeating inlining.
   *
   *   http://jsperf.com/array-slice-call-arguments-2
   *
   *  for untrustworthy benchmark numbers. Only useful for copying whole
   *  arrays, and really only meant to be used with the arguments arraylike.
   *
   *  Also putting this comment inside the function in an effort to defeat
   *  inlining.
   */
</span>  var length = args.length
    , array = []
    , i
    ;

  for (i = 0; i &#x3c; length; i++) {
    array[i] = args[i];
  }

  return array;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.query = query
this.metric = segment.name
this.trace = stackUtil.formatStack(trace.stack)  // trace is an Error object, for capturing the stack.
this.duration = segment.getDurationInMillis()
}

function normalizedHash(value) {
return parseInt(crypto.createHash(&#x27;md5&#x27;).update(value).digest(&#x27;hex&#x27;).<span class="apidocCodeKeywordSpan">slice
</span>(-4), 16)
}

function getQuery(config, trace) {
switch (config.transaction_tracer.record_sql) {
  case &#x27;raw&#x27;:
    return trace.query
  case &#x27;obfuscated&#x27;:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.tracer.prototype.transactionProxy" id="apidoc.element.oneapm.tracer.prototype.transactionProxy">
        function <span class="apidocSignatureSpan">oneapm.tracer.prototype.</span>transactionProxy
        <span class="apidocSignatureSpan">(handler)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function transactionProxy(handler) {
  // if there&#x27;s no handler, there&#x27;s nothing to proxy.
  if (!handler) return;

  var self = this;
  var wrapped = function wrapTransactionInvocation() {
    // don&#x27;t nest transactions, reuse existing ones
    var transaction = self.getTransaction() || new Transaction(self.agent)
      , proxied     = this
      , args        = self.slice(arguments)
      ;

    var returned;
    namespace.bind(function cb_bind() {
      self.setTransaction(transaction);
      self.setSegment(transaction.getTrace().root);
      returned = namespace.bind(handler).apply(proxied, args);
    }, Object.create(null))();

    return returned;
  };
  wrapped[ORIGINAL] = handler;

  return wrapped;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var tracer = agent.tracer;

  shimmer.wrapMethod( thrift, &#x27;thrift&#x27;, &#x27;createServer&#x27;, function wrapper(createServer) {
    return tracer.callbackProxy(function wrappedHandler(service, provider) {
      for( let k in provider ) {
        shimmer.wrapMethod( provider, &#x27;thrift_service.&#x27; + k, k, function wrapper( original ) {

          var proxied = tracer.<span class="apidocCodeKeywordSpan">transactionProxy</span>( function wrapService() {
var transaction = tracer.getTransaction();
if (!transaction) return original.apply(this, arguments);

// Mark it as a web transaction:
transaction.url = THRIFT.PREFIX + &#x27;/&#x27; + k;
transaction.verb = THRIFT.PREFIX;
transaction.partialName = THRIFT.PREFIX + &#x27;/&#x27; + k;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.transaction" id="apidoc.module.oneapm.transaction">module oneapm.transaction</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.transaction.transaction" id="apidoc.element.oneapm.transaction.transaction">
        function <span class="apidocSignatureSpan">oneapm.</span>transaction
        <span class="apidocSignatureSpan">(agent)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transaction(agent) {
  if (!agent) throw new Error(&#x27;every transaction must be bound to the agent&#x27;);

  this.agent = agent;
  this.metrics = new Metrics(
    agent.config.apdex_t,
    agent.mapper,
    agent.metricNameNormalizer
  );

  this.id = id++;
  this.exceptions = [];
  this.timer = new Timer();
  this.timer.begin();

  this._recorders  = [];

  // hidden class optimization
  this.url         = null;
  this.fullUrl     = null;
  this.name        = null;
  this.partialName = null;
  this.statusCode  = null;
  this.error       = null;
  this.verb        = null;
  this.trace       = null;
  this.forceIgnore = null;
  this.ignore      = false;
  this.queueTime   = 0;

  // analytic event context
  this.guid = generateGuid();
  this.force_trace = false;
  this.referer_guid = null;
  this.trip_guid = this.guid;
  this.bytesRead = 0;
  this.bytesWritten = 0;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.transaction.prototype" id="apidoc.module.oneapm.transaction.prototype">module oneapm.transaction.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype._setApdex" id="apidoc.element.oneapm.transaction.prototype._setApdex">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>_setApdex
        <span class="apidocSignatureSpan">(name, duration, keyApdexInMillis)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function _setApdex(name, duration, keyApdexInMillis) {
  var apdexStats = this.metrics.getOrCreateApdexMetric(name, null, keyApdexInMillis);
  if (urltils.isError(this.agent.config, this.statusCode)) {
    apdexStats.incrementFrustrating();
  }
  else {
    apdexStats.recordValueInMillis(duration);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  transaction.measure(NAMES.HTTP,  null, duration, exclusive);
  transaction.measure(scope,       null, duration, exclusive);

  if (transaction.queueTime &#x3e; 0) {
    transaction.measure(NAMES.QUEUETIME, null, transaction.queueTime);
  }

  transaction.<span class="apidocCodeKeywordSpan">_setApdex</span>(NAMES.APDEX + &#x27;/&#x27; + partial, duration, keyApdexInMillis
);
  transaction._setApdex(NAMES.APDEX,                 duration, null);
}

module.exports = recordWeb;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.addRecorder" id="apidoc.element.oneapm.transaction.prototype.addRecorder">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>addRecorder
        <span class="apidocSignatureSpan">(recorder)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addRecorder(recorder) {
  this._recorders.push(recorder)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var ps = parseSql(MYSQL2.PREFIX, sqlStr)
  , wrapped = tracer.callbackProxy(actualCallback)
  , name = MYSQL2.STATEMENT + ps.model + &#x27;/&#x27; + ps.operation
  , segment = tracer.addSegment(name, ps.recordMetrics.bind(ps))
  ;

tracer.getTransaction().<span class="apidocCodeKeywordSpan">addRecorder</span>( ps.recordMetrics.bind( ps, segment ) );
// capture connection info for datastore instance metric
if (this.config) {
  segment.port = this.config.port;
  segment.host = this.config.host;
}

logger.trace(&#x22;Adding node-mysql 2 query trace segment on transaction %d.&#x22;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.applyUserNamingRules" id="apidoc.element.oneapm.transaction.prototype.applyUserNamingRules">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>applyUserNamingRules
        <span class="apidocSignatureSpan">(requestUrl)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function applyUserNamingRules(requestUrl) {
  // 1. user normalization rules (set in configuration)
  var normalizer = this.agent.userNormalizer;
  if (normalizer.isIgnored(requestUrl)) this.ignore = true;
  // User rules take precedence over the API and router introspection.
  // Only override names set via API if rules match.
  if (normalizer.isNormalized(requestUrl)) {
    this.partialName = NAMES.NORMALIZED + normalizer.normalize(requestUrl);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Transaction.prototype.setName = function setName(requestURL, statusCode) {
var normalizer;

this.url = urltils.scrub(requestURL);
this.statusCode = statusCode;

// 1. user normalization rules (set in configuration)
this.<span class="apidocCodeKeywordSpan">applyUserNamingRules</span>(this.url);

// 2. URL normalization rules (sent by server)
normalizer = this.agent.urlNormalizer;
if (normalizer.isIgnored(this.url)) this.ignore = true;
/* Nothing has already set a name for this transaction, so normalize and
 * potentially apply the URL backstop now. Only do so if no user rules
 * matched.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.end" id="apidoc.element.oneapm.transaction.prototype.end">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>end
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end() {
  if (!this.timer.isActive()) return;

  this.timer.end();
  if (this.trace) this.trace.end();

  this.agent.emit(&#x27;transactionFinished&#x27;, this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    return callback;
  }

  var tracer = this.agent.tracer;
  var segment = tracer.addSegment(name, genericRecorder);
  return tracer.callbackProxy(function () {
    callback.apply(this, arguments);
    segment.<span class="apidocCodeKeywordSpan">end</span>();
  });
};

module.exports = API;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.getTrace" id="apidoc.element.oneapm.transaction.prototype.getTrace">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>getTrace
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getTrace() {
  if (!this.trace) this.trace = new Trace(this);

  return this.trace;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var ignored = this.agent.config.ignored_params || [];

var transaction = this.agent.tracer.getTransaction();
if (!transaction) {
  return logger.warn(&#x22;No transaction found for custom parameters.&#x22;);
}

var trace = transaction.<span class="apidocCodeKeywordSpan">getTrace</span>();
if (!trace.custom) {
  return logger.warn(
    &#x22;Couldn&#x27;t add parameter %s to nonexistent custom parameters.&#x22;,
    name
  );
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.isActive" id="apidoc.element.oneapm.transaction.prototype.isActive">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>isActive
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isActive() {
  return this.timer.isActive();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  return this.url ? true : false;
};

/**
 * @return {bool} Is this transaction still alive?
 */
Transaction.prototype.isActive = function isActive() {
  return this.timer.<span class="apidocCodeKeywordSpan">isActive</span>();
};

/**
 * Close out the current transaction and its associated trace. Remove any
 * instances of this transaction annotated onto the call stack.
 */
Transaction.prototype.end = function end() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.isWeb" id="apidoc.element.oneapm.transaction.prototype.isWeb">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>isWeb
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isWeb() {
  return this.url ? true : false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  if (typeof exception !== &#x27;string&#x27; &#x26;&#x26; !exception.message &#x26;&#x26; !exception.stack) {
    return;
  }
}

this.errorCount++;

if(transaction &#x26;&#x26; transaction.<span class="apidocCodeKeywordSpan">isWeb</span>()){
   this.errorWebCount++;
}else{
   this.errorOtherCount++;
}

// allow enabling &#x26; disabling the error tracer at runtime
if (!this.config.collect_errors ||
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.measure" id="apidoc.element.oneapm.transaction.prototype.measure">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>measure
        <span class="apidocSignatureSpan">(name, scope, duration, exclusive)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function measure(name, scope, duration, exclusive) {
  this.metrics.measureMilliseconds(name, scope, duration, exclusive);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  , type        = transaction.isWeb() ? DS.WEB : DS.OTHER
  , operation   = DS.OPERATION + &#x27;/&#x27; + this.type + &#x27;/&#x27; + this.operation
  , model       = DS.STATEMENT + &#x27;/&#x27; + this.type +
                    &#x27;/&#x27; + this.model + &#x27;/&#x27; + this.operation
  ;


if (scope) transaction.<span class="apidocCodeKeywordSpan">measure</span>(model, scope, duration, exclusive);

transaction.measure(model,     null, duration, exclusive);
transaction.measure(operation, null, duration, exclusive);
transaction.measure(type,      null, duration, exclusive);
transaction.measure(DS.ALL,    null, duration, exclusive);

if (segment.port &#x3e; 0) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.record" id="apidoc.element.oneapm.transaction.prototype.record">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>record
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function record() {
  var name = this.name
  for (var i = 0, l = this._recorders.length; i &#x3c; l; ++i) {
    this._recorders[i](name)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/**
* End and close the current trace. Triggers metric recording for trace
* segments that support recording.
*/
Trace.prototype.end = function end() {
 this.root.end();
 this.<span class="apidocCodeKeywordSpan">record</span>();
};

/**
* The instrumentation associates metrics with the different kinds of trace
* segments. The metrics recorders are dependent on the transaction name to
* collect their scoped metrics, and so must wait for the transaction&#x27;s
* name to be finalized before the recording process. Segments are only
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.transaction.prototype.setName" id="apidoc.element.oneapm.transaction.prototype.setName">
        function <span class="apidocSignatureSpan">oneapm.transaction.prototype.</span>setName
        <span class="apidocSignatureSpan">(requestURL, statusCode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setName(requestURL, statusCode) {
  var normalizer;

  this.url = urltils.scrub(requestURL);
  this.statusCode = statusCode;

  // 1. user normalization rules (set in configuration)
  this.applyUserNamingRules(this.url);

  // 2. URL normalization rules (sent by server)
  normalizer = this.agent.urlNormalizer;
  if (normalizer.isIgnored(this.url)) this.ignore = true;
<span class="apidocCodeCommentSpan">  /* Nothing has already set a name for this transaction, so normalize and
   * potentially apply the URL backstop now. Only do so if no user rules
   * matched.
   */
</span>  if (!this.partialName) this.partialName = normalizer.normalize(this.url);

  // 3. transaction name normalization rules (sent by server)
  normalizer = this.agent.transactionNameNormalizer;
  var fullName = NAMES.WEB + &#x27;/&#x27; + this.partialName;
  if (normalizer.isIgnored(fullName)) this.ignore = true;
  // Always applied.
  this.name = normalizer.normalize(fullName);

  // Allow the API to explicitly set the ignored status.
  if (this.forceIgnore === true || this.forceIgnore === false) {
    this.ignore = this.forceIgnore;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
/* We need a name for this transaction, but since error-tracing can happen
 * in the middle of the request, and it&#x27;s possible that the user will
 * recover from the error, name the transaction now, preserving the
 * necessary state to maintain any user-provided naming information.
 */
if (!transaction.name) {
  var partialName = transaction.partialName;
  transaction.<span class="apidocCodeKeywordSpan">setName</span>(url, statusCode);
  transaction.partialName = partialName;
}

var custom = transaction.getTrace().custom;
Object.keys(custom).forEach(function (param) {
  params.custom_params[param] = custom[param];
});
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.oneapm.urltils" id="apidoc.module.oneapm.urltils">module oneapm.urltils</a></h1>


    <h2>
        <a href="#apidoc.element.oneapm.urltils.copyParameters" id="apidoc.element.oneapm.urltils.copyParameters">
        function <span class="apidocSignatureSpan">oneapm.urltils.</span>copyParameters
        <span class="apidocSignatureSpan">(config, source, destination)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function copyParameters(config, source, destination) {
  if (!(config &#x26;&#x26; config.capture_params &#x26;&#x26; source &#x26;&#x26; destination)) return;

  var keys = Object.keys(source);
  for (var i = 0; i &#x3c; keys.length; i++) {
    var key = keys[i];
    if (config.ignored_params.indexOf(key) === -1 &#x26;&#x26; !(key in destination)) {
      destination[key] = source[key];
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
if (!path) return logger.debug({route : route}, &#x22;No path found on Express route.&#x22;);

// when route is a regexp, route.path will be a regexp
if (path instanceof RegExp) path = path.source;


urltils.<span class="apidocCodeKeywordSpan">copyParameters</span>(transaction.agent.config, params, segment.parameters);

if(path[0]!==NAMES.ACTION_DELIMITER){
    path=NAMES.ACTION_DELIMITER+path;
}

transaction.partialName = NAMES.EXPRESS.PREFIX + transaction.verb + path;
debug(&#x22;transaction.partialName=&#x22;,transaction.partialName);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.urltils.isError" id="apidoc.element.oneapm.urltils.isError">
        function <span class="apidocSignatureSpan">oneapm.urltils.</span>isError
        <span class="apidocSignatureSpan">(config, code)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function isError(config, code) {
  var codes = [];
  if (config &#x26;&#x26;
      config.error_collector &#x26;&#x26;
      config.error_collector.ignore_status_codes) {
    codes = config.error_collector.ignore_status_codes;
  }
  return code &#x3e;= 400 &#x26;&#x26; codes.indexOf(code) === -1;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // only care about extracting the type if it&#x27;s Error-like.
  if (exception &#x26;&#x26; exception.constructor &#x26;&#x26; exception.constructor.name) {
    type = exception.constructor.name;
  }
}
else if (transaction &#x26;&#x26;
         transaction.statusCode &#x26;&#x26;
         urltils.<span class="apidocCodeKeywordSpan">isError</span>(config, transaction.statusCode)) {
  message = &#x27;HttpError &#x27; + transaction.statusCode;
}

if (transaction &#x26;&#x26; transaction.url) {
  var url        = transaction.url
    , statusCode = transaction.statusCode || 500
    ;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.urltils.parseParameters" id="apidoc.element.oneapm.urltils.parseParameters">
        function <span class="apidocSignatureSpan">oneapm.urltils.</span>parseParameters
        <span class="apidocSignatureSpan">(requestURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function parseParameters(requestURL) {
  var parsed     = url.parse(requestURL, true)
    , parameters = {}
    ;

  if (parsed.search !== &#x27;&#x27;) {
    Object.keys(parsed.query).forEach(function cb_forEach(key) {
      if (parsed.query[key] === &#x27;&#x27; &#x26;&#x26; parsed.path.indexOf(key + &#x27;=&#x27;) &#x3c; 0) {
        parameters[key] = true;
      }
      else {
        parameters[key] = parsed.query[key];
      }
    });
  }

  return parameters;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  params.custom_params[param] = custom[param];
});

name = transaction.name;
params.request_uri = url;
if (config.capture_params) {
  var reqParams = transaction.getTrace().parameters;
  var urlParams = urltils.<span class="apidocCodeKeywordSpan">parseParameters</span>(url);
  // clear out ignored params
  config.ignored_params.forEach(function cb_forEach(k) {
    // polymorphic hidden classes aren&#x27;t an issue with data bags
    delete urlParams[k];
    delete reqParams[k];
  });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.oneapm.urltils.scrub" id="apidoc.element.oneapm.urltils.scrub">
        function <span class="apidocSignatureSpan">oneapm.urltils.</span>scrub
        <span class="apidocSignatureSpan">(requestURL)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function scrub(requestURL) {
  var path = url.parse(requestURL).pathname;

  if (path) {
    path = path.split(&#x27;;&#x27;)[0];

    if (path !== &#x27;/&#x27; &#x26;&#x26; path.charAt(path.length - 1) === &#x27;/&#x27;) {
      path = path.substring(0, path.length - 1);
    }
  }
  else {
    path = &#x27;/&#x27;;
  }

  return path;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 *
 * @param {string} requestURL The URL to extract the name from.
 * @param {string} statusCode The HTTP status code from the response.
 */
Transaction.prototype.setName = function setName(requestURL, statusCode) {
var normalizer;

this.url = urltils.<span class="apidocCodeKeywordSpan">scrub</span>(requestURL);
this.statusCode = statusCode;

// 1. user normalization rules (set in configuration)
this.applyUserNamingRules(this.url);

// 2. URL normalization rules (sent by server)
normalizer = this.agent.urlNormalizer;
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
